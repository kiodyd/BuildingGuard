{"version":3,"sources":["uiCreateRoom.js"],"names":["uiPanel","require","mvs","cc","Class","extends","properties","onLoad","_super","nodeDict","on","quit","createRoom","clientEvent","eventType","createRoomResponse","uiFunc","closeUI","node","name","destroy","Game","GameManager","blockInput","create","CreateRoomInfo","roomName","getComponent","EditBox","string","GLB","MAX_PLAYER_COUNT","maxPlayer","mode","canWatch","visibility","roomProperty","result","engine","console","log","data","status","rsp","JSON","stringify","roomID","roomId","Canvas","instance","designResolution","height","width","openUI","obj","room","createRoomInit","bind","onDestroy","window","wx","offKeyboardComplete","offKeyboardInput","hideKeyboard","off"],"mappings":"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","file":"uiCreateRoom.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\common\\script","sourcesContent":["var uiPanel = require(\"uiPanel\");\r\nvar mvs = require(\"Matchvs\");\r\ncc.Class({\r\n    extends: uiPanel,\r\n    properties: {},\r\n\r\n    onLoad() {\r\n        this._super();\r\n        //this.playerCntLb = this.nodeDict[\"playerCnt\"].getComponent(cc.Label);\r\n        //this.playerCnt = GLB.PLAYER_COUNTS[0];\r\n        //this.playerCntLb.string = this.playerCnt;\r\n        this.nodeDict[\"quit\"].on(\"click\", this.quit, this);\r\n        this.nodeDict[\"create\"].on(\"click\", this.createRoom, this);\r\n\r\n        clientEvent.on(clientEvent.eventType.createRoomResponse, this.createRoomResponse, this);\r\n    },\r\n\r\n\r\n    quit: function() {\r\n        uiFunc.closeUI(this.node.name);\r\n        this.node.destroy();\r\n    },\r\n\r\n    createRoom: function() {\r\n        Game.GameManager.blockInput();\r\n\r\n        var create = new mvs.CreateRoomInfo();\r\n        create.roomName = this.nodeDict[\"roomName\"].getComponent(cc.EditBox).string;\r\n        GLB.MAX_PLAYER_COUNT = 5;\r\n        create.maxPlayer = GLB.MAX_PLAYER_COUNT;\r\n        create.mode = 0;\r\n        create.canWatch = 0;\r\n        create.visibility = 1;\r\n        create.roomProperty = GLB.MAX_PLAYER_COUNT;\r\n        var result = mvs.engine.createRoom(create, { maxPlayer: GLB.MAX_PLAYER_COUNT });\r\n        if (result !== 0) {\r\n            console.log('创建房间失败,错误码:' + result);\r\n        }\r\n    },\r\n\r\n    createRoomResponse: function(data) {\r\n        var status = data.rsp.status;\r\n        if (status !== 200) {\r\n            console.log('创建房间失败,异步回调错误码: ' + status);\r\n        } else {\r\n            console.log('创建房间成功:' + JSON.stringify(data.rsp));\r\n            console.log('房间号: ' + data.rsp.roomID);\r\n            GLB.roomId = data.rsp.roomID;\r\n\r\n            if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\r\n                uiFunc.openUI(\"uiRoomVer\", function(obj) {\r\n                    var room = obj.getComponent('uiRoom');\r\n                    room.createRoomInit(data.rsp);\r\n                    uiFunc.closeUI(this.node.name);\r\n                    this.node.destroy();\r\n                }.bind(this));\r\n            } else {\r\n                uiFunc.openUI(\"uiRoom\", function(obj) {\r\n                    var room = obj.getComponent('uiRoom');\r\n                    room.createRoomInit(data.rsp);\r\n                    uiFunc.closeUI(this.node.name);\r\n                    this.node.destroy();\r\n                }.bind(this));\r\n            }\r\n        }\r\n    },\r\n\r\n    onDestroy: function() {\r\n        if (window.wx) {\r\n            wx.offKeyboardComplete();\r\n            wx.offKeyboardInput();\r\n            wx.hideKeyboard();\r\n        }\r\n        clientEvent.off(clientEvent.eventType.createRoomResponse, this.createRoomResponse, this);\r\n    }\r\n});\r\n"]}