{"version":3,"sources":["pomeloBuild.js"],"names":["has","Object","prototype","hasOwnProperty","pomeloBuild","cc","Class","onLoad","modules","aliases","requirePomelo","path","parent","orig","resolved","resolve","err","Error","module","exports","client","component","call","relative","charAt","slice","index","paths","i","length","resolvePath","normalize","curr","segs","split","pop","push","concat","join","register","definition","alias","from","to","p","lastIndexOf","arr","obj","selfPomelo","localrequirePomelo","c","exists","create","pomeloBuildObj","indexOf","Emitter","mixin","key","on","event","fn","_callbacks","once","self","off","apply","arguments","_off","removeListener","removeAllListeners","callbacks","splice","emit","args","len","listeners","hasListeners","ByteArray","global","Protocol","PKG_HEAD_BYTES","MSG_FLAG_BYTES","MSG_ROUTE_CODE_BYTES","MSG_ID_MAX_BYTES","MSG_ROUTE_LEN_BYTES","MSG_ROUTE_CODE_MAX","MSG_COMPRESS_ROUTE_MASK","MSG_TYPE_MASK","Package","Message","TYPE_HANDSHAKE","TYPE_HANDSHAKE_ACK","TYPE_HEARTBEAT","TYPE_DATA","TYPE_KICK","TYPE_REQUEST","TYPE_NOTIFY","TYPE_RESPONSE","TYPE_PUSH","strencode","str","byteArray","offset","charCode","charCodeAt","codes","j","_buffer","copyArray","strdecode","buffer","bytes","array","end","res","chunk","String","fromCharCode","encode","type","body","decode","id","compressRoute","route","msg","idBytes","msgHasId","caculateMsgIdBytes","msgLen","msgHasRoute","encodeMsgFlag","encodeMsgId","encodeMsgRoute","encodeMsgBody","bytesLen","byteLength","flag","byte","routeLen","bodyLen","dest","doffset","src","soffset","copy","Buffer","Uint8Array","Protobuf","init","opts","encoder","encoderProtos","decoder","decoderProtos","protobuf","constants","TYPES","uInt32","sInt32","int32","double","string","message","float","Util","util","isSimpleType","Codec","codec","ArrayBuffer","float32Array","Float32Array","float64Array","Float64Array","uInt8Array","encodeUInt32","n","parseInt","isNaN","result","tmp","next","Math","floor","encodeSInt32","abs","decodeUInt32","m","pow","decodeSInt32","encodeFloat","decodeFloat","encodeDouble","subarray","decodeDouble","encodeStr","code","encode2UTF8","decodeStr","codeLength","MsgEncoder","constant","protos","checkMsg","JSON","stringify","encodeMsg","name","proto","option","__messages","writeBytes","encodeTag","tag","encodeProp","encodeArray","value","tmpBuffer","MsgDecoder","setProtos","buf","decodeMsg","head","getHead","__tags","decodeProp","decodeArray","isFinish","peekHead","getBytes","peekBytes","pos","b","JS_WS_CLIENT_TYPE","JS_WS_CLIENT_VERSION","EventEmitter","RES_OK","RES_FAIL","RES_OLD_CLIENT","o","F","root","window","pomelo","socket","reqId","handlers","routeMap","heartbeatInterval","heartbeatTimeout","nextHeartbeatTimeout","gapThreshold","heartbeatId","heartbeatTimeoutId","handshakeCallback","handshakeBuffer","version","initCallback","params","cb","host","port","wsStr","url","user","initWebSocket","console","log","onopen","send","onmessage","processPackage","data","Date","now","onerror","warn","onclose","WebSocket","binaryType","disconnect","close","clearTimeout","request","sendMessage","notify","clearCallback","isConnecting","readyState","CONNECTING","isOpen","OPEN","isClosed","CLOSED","isClosing","CLOSING","dict","packet","handler","heartbeat","setTimeout","heartbeatTimeoutCb","gap","handshake","parse","handshakeInit","onData","deCompose","processMessage","onKick","info","reason","processMessageBatch","msgs","l","server","abbrs","sys","initData","protocol"],"mappings":"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","file":"pomeloBuild.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\common\\script\\basic\\rankNetwork","sourcesContent":["/**\r\n * 此文件来自于pomelo helloworld lib/build/build.js\r\n */\r\n/**\r\n * hasOwnProperty.\r\n */\r\n\r\nvar has = Object.prototype.hasOwnProperty;\r\n\r\nvar pomeloBuild = cc.Class({\r\n    onLoad: function () {\r\n        /**\r\n         * Registered modules.\r\n         */\r\n\r\n        this.modules = {};\r\n\r\n        /**\r\n         * Registered aliases.\r\n         */\r\n\r\n        this.aliases = {};\r\n    },\r\n\r\n    requirePomelo: function(path, parent, orig) {\r\n        var resolved = this.resolve(path);\r\n\r\n        // lookup failed\r\n        if (null === resolved) {\r\n            orig = orig || path;\r\n            parent = parent || 'root';\r\n            var err = new Error('Failed to requirePomelo \"' + orig + '\" from \"' + parent + '\"');\r\n            err.path = orig;\r\n            err.parent = parent;\r\n            err.requirePomelo = true;\r\n            throw err;\r\n        }\r\n\r\n        var module = this.modules[resolved];\r\n\r\n        // perform real requirePomelo()\r\n        // by invoking the module's\r\n        // registered function\r\n        if (!module.exports) {\r\n            module.exports = {};\r\n            module.client = module.component = true;\r\n            module.call(this, module.exports, this.relative(resolved), module);\r\n        }\r\n\r\n        return module.exports;\r\n    },\r\n\r\n    /**\r\n     * Resolve `path`.\r\n     *\r\n     * Lookup:\r\n     *\r\n     *   - PATH/index.js\r\n     *   - PATH.js\r\n     *   - PATH\r\n     *\r\n     * @param {String} path\r\n     * @return {String} path or null\r\n     * @api private\r\n     */\r\n\r\n    resolve: function (path) {\r\n        if (path.charAt(0) === '/') path = path.slice(1);\r\n        var index = path + '/index.js';\r\n\r\n        var paths = [\r\n            path,\r\n            path + '.js',\r\n            path + '.json',\r\n            path + '/index.js',\r\n            path + '/index.json'\r\n        ];\r\n\r\n        for (var i = 0; i < paths.length; i++) {\r\n            var resolvePath = paths[i];\r\n            if (has.call(this.modules, resolvePath)) return resolvePath;\r\n        }\r\n\r\n        if (has.call(this.aliases, index)) {\r\n            return this.aliases[index];\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Normalize `path` relative to the current path.\r\n     *\r\n     * @param {String} curr\r\n     * @param {String} path\r\n     * @return {String}\r\n     * @api private\r\n     */\r\n\r\n    normalize: function (curr, path) {\r\n        var segs = [];\r\n\r\n        if ('.' !== path.charAt(0)) return path;\r\n\r\n        curr = curr.split('/');\r\n        path = path.split('/');\r\n\r\n        for (var i = 0; i < path.length; ++i) {\r\n            if ('..' === path[i]) {\r\n                curr.pop();\r\n            } else if ('.' !== path[i] && '' !== path[i]) {\r\n                segs.push(path[i]);\r\n            }\r\n        }\r\n\r\n        return curr.concat(segs).join('/');\r\n    },\r\n\r\n    /**\r\n     * Register module at `path` with callback `definition`.\r\n     *\r\n     * @param {String} path\r\n     * @param {Function} definition\r\n     * @api private\r\n     */\r\n\r\n    register: function (path, definition) {\r\n        this.modules[path] = definition;\r\n    },\r\n\r\n    /**\r\n     * Alias a module definition.\r\n     *\r\n     * @param {String} from\r\n     * @param {String} to\r\n     * @api private\r\n     */\r\n\r\n    alias: function (from, to) {\r\n        if (!has.call(this.modules, from)) {\r\n            throw new Error('Failed to alias \"' + from + '\", it does not exist');\r\n        }\r\n        this.aliases[to] = from;\r\n    },\r\n\r\n    /**\r\n     * Return a requirePomelo function relative to the `parent` path.\r\n     *\r\n     * @param {String} parent\r\n     * @return {Function}\r\n     * @api private\r\n     */\r\n\r\n    relative: function (parent) {\r\n        var p = this.normalize(parent, '..');\r\n\r\n        /**\r\n         * lastIndexOf helper.\r\n         */\r\n\r\n        function lastIndexOf(arr, obj) {\r\n            var i = arr.length;\r\n            while (i--) {\r\n                if (arr[i] === obj) return i;\r\n            }\r\n            return -1;\r\n        }\r\n\r\n        /**\r\n         * The relative requirePomelo() itself.\r\n         */\r\n\r\n        var selfPomelo = this;\r\n        function localrequirePomelo(path) {\r\n            var resolved = localrequirePomelo.resolve(path);\r\n            return selfPomelo.requirePomelo(resolved, parent, path);\r\n        }\r\n\r\n        /**\r\n         * Resolve relative to the parent.\r\n         */\r\n\r\n        localrequirePomelo.resolve = function (path) {\r\n            var c = path.charAt(0);\r\n            if ('/' === c) return path.slice(1);\r\n            if ('.' === c) return selfPomelo.normalize(p, path);\r\n\r\n            // resolve deps by returning\r\n            // the dep in the nearest \"deps\"\r\n            // directory\r\n            var segs = parent.split('/');\r\n            var i = lastIndexOf(segs, 'deps') + 1;\r\n            if (!i) i = 0;\r\n            path = segs.slice(0, i + 1).join('/') + '/deps/' + path;\r\n            return path;\r\n        };\r\n\r\n        /**\r\n         * Check if module is defined at `path`.\r\n         */\r\n\r\n        localrequirePomelo.exists = function (path) {\r\n            return has.call(selfPomelo.modules, localrequirePomelo.resolve(path));\r\n        };\r\n\r\n        return localrequirePomelo;\r\n    }\r\n});\r\n\r\npomeloBuild.create = function () {\r\n    var pomeloBuildObj = new pomeloBuild();\r\n    pomeloBuildObj.onLoad();\r\n\r\n    pomeloBuildObj.register(\"component-indexof/index.js\", function (exports, requirePomelo, module) {\r\n\r\n        var indexOf = [].indexOf;\r\n\r\n        module.exports = function (arr, obj) {\r\n            if (indexOf) return arr.indexOf(obj);\r\n            for (var i = 0; i < arr.length; ++i) {\r\n                if (arr[i] === obj) return i;\r\n            }\r\n            return -1;\r\n        };\r\n    });\r\n\r\n    pomeloBuildObj.register(\"component-emitter/index.js\", function (exports, requirePomelo, module) {\r\n\r\n        /**\r\n         * Module dependencies.\r\n         */\r\n\r\n        var index = requirePomelo('indexof');\r\n\r\n        /**\r\n         * Expose `Emitter`.\r\n         */\r\n\r\n        module.exports = Emitter;\r\n\r\n        /**\r\n         * Initialize a new `Emitter`.\r\n         *\r\n         * @api public\r\n         */\r\n\r\n        function Emitter(obj) {\r\n            if (obj) return mixin(obj);\r\n        };\r\n\r\n        /**\r\n         * Mixin the emitter properties.\r\n         *\r\n         * @param {Object} obj\r\n         * @return {Object}\r\n         * @api private\r\n         */\r\n\r\n        function mixin(obj) {\r\n            for (var key in Emitter.prototype) {\r\n                obj[key] = Emitter.prototype[key];\r\n            }\r\n            return obj;\r\n        }\r\n\r\n        /**\r\n         * Listen on the given `event` with `fn`.\r\n         *\r\n         * @param {String} event\r\n         * @param {Function} fn\r\n         * @return {Emitter}\r\n         * @api public\r\n         */\r\n\r\n        Emitter.prototype.on = function (event, fn) {\r\n            this._callbacks = this._callbacks || {};\r\n            (this._callbacks[event] = this._callbacks[event] || [])\r\n                .push(fn);\r\n            return this;\r\n        };\r\n\r\n        /**\r\n         * Adds an `event` listener that will be invoked a single\r\n         * time then automatically removed.\r\n         *\r\n         * @param {String} event\r\n         * @param {Function} fn\r\n         * @return {Emitter}\r\n         * @api public\r\n         */\r\n\r\n        Emitter.prototype.once = function (event, fn) {\r\n            var self = this;\r\n            this._callbacks = this._callbacks || {};\r\n\r\n            function on() {\r\n                self.off(event, on);\r\n                fn.apply(this, arguments);\r\n            }\r\n\r\n            fn._off = on;\r\n            this.on(event, on);\r\n            return this;\r\n        };\r\n\r\n        /**\r\n         * Remove the given callback for `event` or all\r\n         * registered callbacks.\r\n         *\r\n         * @param {String} event\r\n         * @param {Function} fn\r\n         * @return {Emitter}\r\n         * @api public\r\n         */\r\n\r\n        Emitter.prototype.off =\r\n            Emitter.prototype.removeListener =\r\n                Emitter.prototype.removeAllListeners = function (event, fn) {\r\n                    this._callbacks = this._callbacks || {};\r\n\r\n                    // all\r\n                    if (0 === arguments.length) {\r\n                        this._callbacks = {};\r\n                        return this;\r\n                    }\r\n\r\n                    // specific event\r\n                    var callbacks = this._callbacks[event];\r\n                    if (!callbacks) return this;\r\n\r\n                    // remove all handlers\r\n                    if (1 === arguments.length) {\r\n                        delete this._callbacks[event];\r\n                        return this;\r\n                    }\r\n\r\n                    // remove specific handler\r\n                    var i = index(callbacks, fn._off || fn);\r\n                    if (~i) callbacks.splice(i, 1);\r\n                    return this;\r\n                };\r\n\r\n        /**\r\n         * Emit `event` with the given args.\r\n         *\r\n         * @param {String} event\r\n         * @param {Mixed} ...\r\n         * @return {Emitter}\r\n         */\r\n\r\n        Emitter.prototype.emit = function (event) {\r\n            this._callbacks = this._callbacks || {};\r\n            var args = [].slice.call(arguments, 1), callbacks = this._callbacks[event];\r\n\r\n            if (callbacks) {\r\n                callbacks = callbacks.slice(0);\r\n                for (var i = 0, len = callbacks.length; i < len; ++i) {\r\n                    callbacks[i].apply(this, args);\r\n                }\r\n            }\r\n\r\n            return this;\r\n        };\r\n\r\n        /**\r\n         * Return array of callbacks for `event`.\r\n         *\r\n         * @param {String} event\r\n         * @return {Array}\r\n         * @api public\r\n         */\r\n\r\n        Emitter.prototype.listeners = function (event) {\r\n            this._callbacks = this._callbacks || {};\r\n            return this._callbacks[event] || [];\r\n        };\r\n\r\n        /**\r\n         * Check if this emitter has `event` handlers.\r\n         *\r\n         * @param {String} event\r\n         * @return {Boolean}\r\n         * @api public\r\n         */\r\n\r\n        Emitter.prototype.hasListeners = function (event) {\r\n            return !!this.listeners(event).length;\r\n        };\r\n\r\n    });\r\n\r\n    pomeloBuildObj.register(\"NetEase-pomelo-protocol/lib/protocol.js\", function (exports, requirePomelo, module) {\r\n        (function (exports, ByteArray, global) {\r\n            var Protocol = exports;\r\n\r\n            var PKG_HEAD_BYTES = 4;\r\n            var MSG_FLAG_BYTES = 1;\r\n            var MSG_ROUTE_CODE_BYTES = 2;\r\n            var MSG_ID_MAX_BYTES = 5;\r\n            var MSG_ROUTE_LEN_BYTES = 1;\r\n\r\n            var MSG_ROUTE_CODE_MAX = 0xffff;\r\n\r\n            var MSG_COMPRESS_ROUTE_MASK = 0x1;\r\n            var MSG_TYPE_MASK = 0x7;\r\n\r\n            var Package = Protocol.Package = {};\r\n            var Message = Protocol.Message = {};\r\n\r\n            Package.TYPE_HANDSHAKE = 1;\r\n            Package.TYPE_HANDSHAKE_ACK = 2;\r\n            Package.TYPE_HEARTBEAT = 3;\r\n            Package.TYPE_DATA = 4;\r\n            Package.TYPE_KICK = 5;\r\n\r\n            Message.TYPE_REQUEST = 0;\r\n            Message.TYPE_NOTIFY = 1;\r\n            Message.TYPE_RESPONSE = 2;\r\n            Message.TYPE_PUSH = 3;\r\n\r\n            /**\r\n             * pomele client encode\r\n             * id message id;\r\n             * route message route\r\n             * msg message body\r\n             * socketio current support string\r\n             */\r\n            Protocol.strencode = function (str) {\r\n                var byteArray = new ByteArray(str.length * 3);\r\n                var offset = 0;\r\n                for (var i = 0; i < str.length; i++) {\r\n                    var charCode = str.charCodeAt(i);\r\n                    var codes = null;\r\n                    if (charCode <= 0x7f) {\r\n                        codes = [charCode];\r\n                    } else if (charCode <= 0x7ff) {\r\n                        codes = [0xc0 | (charCode >> 6), 0x80 | (charCode & 0x3f)];\r\n                    } else {\r\n                        codes = [0xe0 | (charCode >> 12), 0x80 | ((charCode & 0xfc0) >> 6), 0x80 | (charCode & 0x3f)];\r\n                    }\r\n                    for (var j = 0; j < codes.length; j++) {\r\n                        byteArray[offset] = codes[j];\r\n                        ++offset;\r\n                    }\r\n                }\r\n                var _buffer = new ByteArray(offset);\r\n                copyArray(_buffer, 0, byteArray, 0, offset);\r\n                return _buffer;\r\n            };\r\n\r\n            /**\r\n             * client decode\r\n             * msg String data\r\n             * return Message Object\r\n             */\r\n            Protocol.strdecode = function (buffer) {\r\n                var bytes = new ByteArray(buffer);\r\n                var array = [];\r\n                var offset = 0;\r\n                var charCode = 0;\r\n                var end = bytes.length;\r\n                while (offset < end) {\r\n                    if (bytes[offset] < 128) {\r\n                        charCode = bytes[offset];\r\n                        offset += 1;\r\n                    } else if (bytes[offset] < 224) {\r\n                        charCode = ((bytes[offset] & 0x3f) << 6) + (bytes[offset + 1] & 0x3f);\r\n                        offset += 2;\r\n                    } else {\r\n                        charCode = ((bytes[offset] & 0x0f) << 12) + ((bytes[offset + 1] & 0x3f) << 6) + (bytes[offset + 2] & 0x3f);\r\n                        offset += 3;\r\n                    }\r\n                    array.push(charCode);\r\n                }\r\n                var res = '';\r\n                var chunk = 8 * 1024;\r\n                var i;\r\n                for (i = 0; i < array.length / chunk; i++) {\r\n                    res += String.fromCharCode.apply(null, array.slice(i * chunk, (i + 1) * chunk));\r\n                }\r\n                res += String.fromCharCode.apply(null, array.slice(i * chunk));\r\n                return res;\r\n            };\r\n\r\n            /**\r\n             * Package protocol encode.\r\n             *\r\n             * Pomelo package format:\r\n             * +------+-------------+------------------+\r\n             * | type | body length |       body       |\r\n             * +------+-------------+------------------+\r\n             *\r\n             * Head: 4bytes\r\n             *   0: package type,\r\n             *      1 - handshake,\r\n             *      2 - handshake ack,\r\n             *      3 - heartbeat,\r\n             *      4 - data\r\n             *      5 - kick\r\n             *   1 - 3: big-endian body length\r\n             * Body: body length bytes\r\n             *\r\n             * @param  {Number}    type   package type\r\n             * @param  {ByteArray} body   body content in bytes\r\n             * @return {ByteArray}        new byte array that contains encode result\r\n             */\r\n            Package.encode = function (type, body) {\r\n                var length = body ? body.length : 0;\r\n                var buffer = new ByteArray(PKG_HEAD_BYTES + length);\r\n                var index = 0;\r\n                buffer[index++] = type & 0xff;\r\n                buffer[index++] = (length >> 16) & 0xff;\r\n                buffer[index++] = (length >> 8) & 0xff;\r\n                buffer[index++] = length & 0xff;\r\n                if (body) {\r\n                    copyArray(buffer, index, body, 0, length);\r\n                }\r\n                return buffer;\r\n            };\r\n\r\n            /**\r\n             * Package protocol decode.\r\n             * See encode for package format.\r\n             *\r\n             * @param  {ByteArray} buffer byte array containing package content\r\n             * @return {Object}           {type: package type, buffer: body byte array}\r\n             */\r\n            Package.decode = function (buffer) {\r\n                var bytes = new ByteArray(buffer);\r\n                var type = bytes[0];\r\n                var index = 1;\r\n                var length = ((bytes[index++]) << 16 | (bytes[index++]) << 8 | bytes[index++]) >>> 0;\r\n                var body = length ? new ByteArray(length) : null;\r\n                copyArray(body, 0, bytes, PKG_HEAD_BYTES, length);\r\n                return {'type': type, 'body': body};\r\n            };\r\n\r\n            /**\r\n             * Message protocol encode.\r\n             *\r\n             * @param  {Number} id            message id\r\n             * @param  {Number} type          message type\r\n             * @param  {Number} compressRoute whether compress route\r\n             * @param  {Number|String} route  route code or route string\r\n             * @param  {Buffer} msg           message body bytes\r\n             * @return {Buffer}               encode result\r\n             */\r\n            Message.encode = function (id, type, compressRoute, route, msg) {\r\n                // caculate message max length\r\n                var idBytes = msgHasId(type) ? caculateMsgIdBytes(id) : 0;\r\n                var msgLen = MSG_FLAG_BYTES + idBytes;\r\n\r\n                if (msgHasRoute(type)) {\r\n                    if (compressRoute) {\r\n                        if (typeof route !== 'number') {\r\n                            throw new Error('error flag for number route!');\r\n                        }\r\n                        msgLen += MSG_ROUTE_CODE_BYTES;\r\n                    } else {\r\n                        msgLen += MSG_ROUTE_LEN_BYTES;\r\n                        if (route) {\r\n                            route = Protocol.strencode(route);\r\n                            if (route.length > 255) {\r\n                                throw new Error('route maxlength is overflow');\r\n                            }\r\n                            msgLen += route.length;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (msg) {\r\n                    msgLen += msg.length;\r\n                }\r\n\r\n                var buffer = new ByteArray(msgLen);\r\n                var offset = 0;\r\n\r\n                // add flag\r\n                offset = encodeMsgFlag(type, compressRoute, buffer, offset);\r\n\r\n                // add message id\r\n                if (msgHasId(type)) {\r\n                    offset = encodeMsgId(id, idBytes, buffer, offset);\r\n                }\r\n\r\n                // add route\r\n                if (msgHasRoute(type)) {\r\n                    offset = encodeMsgRoute(compressRoute, route, buffer, offset);\r\n                }\r\n\r\n                // add body\r\n                if (msg) {\r\n                    offset = encodeMsgBody(msg, buffer, offset);\r\n                }\r\n\r\n                return buffer;\r\n            };\r\n\r\n            /**\r\n             * Message protocol decode.\r\n             *\r\n             * @param  {Buffer|Uint8Array} buffer message bytes\r\n             * @return {Object}            message object\r\n             */\r\n            Message.decode = function (buffer) {\r\n                var bytes = new ByteArray(buffer);\r\n                var bytesLen = bytes.length || bytes.byteLength;\r\n                var offset = 0;\r\n                var id = 0;\r\n                var route = null;\r\n\r\n                // parse flag\r\n                var flag = bytes[offset++];\r\n                var compressRoute = flag & MSG_COMPRESS_ROUTE_MASK;\r\n                var type = (flag >> 1) & MSG_TYPE_MASK;\r\n\r\n                // parse id\r\n                if (msgHasId(type)) {\r\n                    var byte = bytes[offset++];\r\n                    id = byte & 0x7f;\r\n                    while (byte & 0x80) {\r\n                        id <<= 7;\r\n                        byte = bytes[offset++];\r\n                        id |= byte & 0x7f;\r\n                    }\r\n                }\r\n\r\n                // parse route\r\n                if (msgHasRoute(type)) {\r\n                    if (compressRoute) {\r\n                        route = (bytes[offset++]) << 8 | bytes[offset++];\r\n                    } else {\r\n                        var routeLen = bytes[offset++];\r\n                        if (routeLen) {\r\n                            route = new ByteArray(routeLen);\r\n                            copyArray(route, 0, bytes, offset, routeLen);\r\n                            route = Protocol.strdecode(route);\r\n                        } else {\r\n                            route = '';\r\n                        }\r\n                        offset += routeLen;\r\n                    }\r\n                }\r\n\r\n                // parse body\r\n                var bodyLen = bytesLen - offset;\r\n                var body = new ByteArray(bodyLen);\r\n\r\n                copyArray(body, 0, bytes, offset, bodyLen);\r\n\r\n                return {\r\n                    'id': id, 'type': type, 'compressRoute': compressRoute,\r\n                    'route': route, 'body': body\r\n                };\r\n            };\r\n\r\n            var copyArray = function (dest, doffset, src, soffset, length) {\r\n                if ('function' === typeof src.copy) {\r\n                    // Buffer\r\n                    src.copy(dest, doffset, soffset, soffset + length);\r\n                } else {\r\n                    // Uint8Array\r\n                    for (var index = 0; index < length; index++) {\r\n                        dest[doffset++] = src[soffset++];\r\n                    }\r\n                }\r\n            };\r\n\r\n            var msgHasId = function (type) {\r\n                return type === Message.TYPE_REQUEST || type === Message.TYPE_RESPONSE;\r\n            };\r\n\r\n            var msgHasRoute = function (type) {\r\n                return type === Message.TYPE_REQUEST || type === Message.TYPE_NOTIFY ||\r\n                    type === Message.TYPE_PUSH;\r\n            };\r\n\r\n            var caculateMsgIdBytes = function (id) {\r\n                var len = 0;\r\n                do {\r\n                    len += 1;\r\n                    id >>= 7;\r\n                } while (id > 0);\r\n                return len;\r\n            };\r\n\r\n            var encodeMsgFlag = function (type, compressRoute, buffer, offset) {\r\n                if (type !== Message.TYPE_REQUEST && type !== Message.TYPE_NOTIFY &&\r\n                    type !== Message.TYPE_RESPONSE && type !== Message.TYPE_PUSH) {\r\n                    throw new Error('unkonw message type: ' + type);\r\n                }\r\n\r\n                buffer[offset] = (type << 1) | (compressRoute ? 1 : 0);\r\n\r\n                return offset + MSG_FLAG_BYTES;\r\n            };\r\n\r\n            var encodeMsgId = function (id, idBytes, buffer, offset) {\r\n                var index = offset + idBytes - 1;\r\n                buffer[index--] = id & 0x7f;\r\n                while (index >= offset) {\r\n                    id >>= 7;\r\n                    buffer[index--] = id & 0x7f | 0x80;\r\n                }\r\n                return offset + idBytes;\r\n            };\r\n\r\n            var encodeMsgRoute = function (compressRoute, route, buffer, offset) {\r\n                if (compressRoute) {\r\n                    if (route > MSG_ROUTE_CODE_MAX) {\r\n                        throw new Error('route number is overflow');\r\n                    }\r\n\r\n                    buffer[offset++] = (route >> 8) & 0xff;\r\n                    buffer[offset++] = route & 0xff;\r\n                } else {\r\n                    if (route) {\r\n                        buffer[offset++] = route.length & 0xff;\r\n                        copyArray(buffer, offset, route, 0, route.length);\r\n                        offset += route.length;\r\n                    } else {\r\n                        buffer[offset++] = 0;\r\n                    }\r\n                }\r\n\r\n                return offset;\r\n            };\r\n\r\n            var encodeMsgBody = function (msg, buffer, offset) {\r\n                copyArray(buffer, offset, msg, 0, msg.length);\r\n                return offset + msg.length;\r\n            };\r\n\r\n            module.exports = Protocol;\r\n        })('object' === typeof module ? module.exports : (this.Protocol = {}), 'object' === typeof module ? Buffer : Uint8Array, this);\r\n\r\n    });\r\n\r\n    pomeloBuildObj.register(\"pomelonode-pomelo-protobuf/lib/client/protobuf.js\", function (exports, requirePomelo, module) {\r\n        /* ProtocolBuffer client 0.1.0*/\r\n\r\n        /**\r\n         * pomelo-protobuf\r\n         * @author <zhang0935@gmail.com>\r\n         */\r\n\r\n        /**\r\n         * Protocol buffer root\r\n         * In browser, it will be window.protbuf\r\n         */\r\n        (function (exports, global) {\r\n            var Protobuf = exports;\r\n\r\n            Protobuf.init = function (opts) {\r\n                //On the serverside, use serverProtos to encode messages send to client\r\n                Protobuf.encoder.init(opts.encoderProtos);\r\n\r\n                //On the serverside, user clientProtos to decode messages receive from clients\r\n                Protobuf.decoder.init(opts.decoderProtos);\r\n            };\r\n\r\n            Protobuf.encode = function (key, msg) {\r\n                return Protobuf.encoder.encode(key, msg);\r\n            };\r\n\r\n            Protobuf.decode = function (key, msg) {\r\n                return Protobuf.decoder.decode(key, msg);\r\n            };\r\n\r\n            // exports to support for components\r\n            module.exports = Protobuf;\r\n        })('object' === typeof module ? module.exports : (this.protobuf = {}), this);\r\n\r\n        /**\r\n         * constants\r\n         */\r\n        (function (exports, global) {\r\n            var constants = exports.constants = {};\r\n\r\n            constants.TYPES = {\r\n                uInt32: 0,\r\n                sInt32: 0,\r\n                int32: 0,\r\n                double: 1,\r\n                string: 2,\r\n                message: 2,\r\n                float: 5\r\n            };\r\n\r\n        })('undefined' !== typeof protobuf ? protobuf : module.exports, this);\r\n\r\n        /**\r\n         * util module\r\n         */\r\n        (function (exports, global) {\r\n\r\n            var Util = exports.util = {};\r\n\r\n            Util.isSimpleType = function (type) {\r\n                return ( type === 'uInt32' ||\r\n                type === 'sInt32' ||\r\n                type === 'int32' ||\r\n                type === 'uInt64' ||\r\n                type === 'sInt64' ||\r\n                type === 'float' ||\r\n                type === 'double' );\r\n            };\r\n\r\n        })('undefined' !== typeof protobuf ? protobuf : module.exports, this);\r\n\r\n        /**\r\n         * codec module\r\n         */\r\n        (function (exports, global) {\r\n\r\n            var Codec = exports.codec = {};\r\n\r\n            var buffer = new ArrayBuffer(8);\r\n            var float32Array = new Float32Array(buffer);\r\n            var float64Array = new Float64Array(buffer);\r\n            var uInt8Array = new Uint8Array(buffer);\r\n\r\n            Codec.encodeUInt32 = function (n) {\r\n                var n = parseInt(n);\r\n                if (isNaN(n) || n < 0) {\r\n                    return null;\r\n                }\r\n\r\n                var result = [];\r\n                do {\r\n                    var tmp = n % 128;\r\n                    var next = Math.floor(n / 128);\r\n\r\n                    if (next !== 0) {\r\n                        tmp = tmp + 128;\r\n                    }\r\n                    result.push(tmp);\r\n                    n = next;\r\n                } while (n !== 0);\r\n\r\n                return result;\r\n            };\r\n\r\n            Codec.encodeSInt32 = function (n) {\r\n                var n = parseInt(n);\r\n                if (isNaN(n)) {\r\n                    return null;\r\n                }\r\n                n = n < 0 ? (Math.abs(n) * 2 - 1) : n * 2;\r\n\r\n                return Codec.encodeUInt32(n);\r\n            };\r\n\r\n            Codec.decodeUInt32 = function (bytes) {\r\n                var n = 0;\r\n\r\n                for (var i = 0; i < bytes.length; i++) {\r\n                    var m = parseInt(bytes[i]);\r\n                    n = n + ((m & 0x7f) * Math.pow(2, (7 * i)));\r\n                    if (m < 128) {\r\n                        return n;\r\n                    }\r\n                }\r\n\r\n                return n;\r\n            };\r\n\r\n\r\n            Codec.decodeSInt32 = function (bytes) {\r\n                var n = this.decodeUInt32(bytes);\r\n                var flag = ((n % 2) === 1) ? -1 : 1;\r\n\r\n                n = ((n % 2 + n) / 2) * flag;\r\n\r\n                return n;\r\n            };\r\n\r\n            Codec.encodeFloat = function (float) {\r\n                float32Array[0] = float;\r\n                return uInt8Array;\r\n            };\r\n\r\n            Codec.decodeFloat = function (bytes, offset) {\r\n                if (!bytes || bytes.length < (offset + 4)) {\r\n                    return null;\r\n                }\r\n\r\n                for (var i = 0; i < 4; i++) {\r\n                    uInt8Array[i] = bytes[offset + i];\r\n                }\r\n\r\n                return float32Array[0];\r\n            };\r\n\r\n            Codec.encodeDouble = function (double) {\r\n                float64Array[0] = double;\r\n                return uInt8Array.subarray(0, 8);\r\n            };\r\n\r\n            Codec.decodeDouble = function (bytes, offset) {\r\n                if (!bytes || bytes.length < (8 + offset)) {\r\n                    return null;\r\n                }\r\n\r\n                for (var i = 0; i < 8; i++) {\r\n                    uInt8Array[i] = bytes[offset + i];\r\n                }\r\n\r\n                return float64Array[0];\r\n            };\r\n\r\n            Codec.encodeStr = function (bytes, offset, str) {\r\n                for (var i = 0; i < str.length; i++) {\r\n                    var code = str.charCodeAt(i);\r\n                    var codes = encode2UTF8(code);\r\n\r\n                    for (var j = 0; j < codes.length; j++) {\r\n                        bytes[offset] = codes[j];\r\n                        offset++;\r\n                    }\r\n                }\r\n\r\n                return offset;\r\n            };\r\n\r\n            /**\r\n             * Decode string from utf8 bytes\r\n             */\r\n            Codec.decodeStr = function (bytes, offset, length) {\r\n                var array = [];\r\n                var end = offset + length;\r\n\r\n                while (offset < end) {\r\n                    var code = 0;\r\n\r\n                    if (bytes[offset] < 128) {\r\n                        code = bytes[offset];\r\n\r\n                        offset += 1;\r\n                    } else if (bytes[offset] < 224) {\r\n                        code = ((bytes[offset] & 0x3f) << 6) + (bytes[offset + 1] & 0x3f);\r\n                        offset += 2;\r\n                    } else {\r\n                        code = ((bytes[offset] & 0x0f) << 12) + ((bytes[offset + 1] & 0x3f) << 6) + (bytes[offset + 2] & 0x3f);\r\n                        offset += 3;\r\n                    }\r\n\r\n                    array.push(code);\r\n\r\n                }\r\n\r\n                var str = '';\r\n                for (var i = 0; i < array.length;) {\r\n                    str += String.fromCharCode.apply(null, array.slice(i, i + 10000));\r\n                    i += 10000;\r\n                }\r\n\r\n                return str;\r\n            };\r\n\r\n            /**\r\n             * Return the byte length of the str use utf8\r\n             */\r\n            Codec.byteLength = function (str) {\r\n                if (typeof(str) !== 'string') {\r\n                    return -1;\r\n                }\r\n\r\n                var length = 0;\r\n\r\n                for (var i = 0; i < str.length; i++) {\r\n                    var code = str.charCodeAt(i);\r\n                    length += codeLength(code);\r\n                }\r\n\r\n                return length;\r\n            };\r\n\r\n            /**\r\n             * Encode a unicode16 char code to utf8 bytes\r\n             */\r\n            function encode2UTF8(charCode) {\r\n                if (charCode <= 0x7f) {\r\n                    return [charCode];\r\n                } else if (charCode <= 0x7ff) {\r\n                    return [0xc0 | (charCode >> 6), 0x80 | (charCode & 0x3f)];\r\n                } else {\r\n                    return [0xe0 | (charCode >> 12), 0x80 | ((charCode & 0xfc0) >> 6), 0x80 | (charCode & 0x3f)];\r\n                }\r\n            }\r\n\r\n            function codeLength(code) {\r\n                if (code <= 0x7f) {\r\n                    return 1;\r\n                } else if (code <= 0x7ff) {\r\n                    return 2;\r\n                } else {\r\n                    return 3;\r\n                }\r\n            }\r\n        })('undefined' !== typeof protobuf ? protobuf : module.exports, this);\r\n\r\n        /**\r\n         * encoder module\r\n         */\r\n        (function (exports, global) {\r\n\r\n            var protobuf = exports;\r\n            var MsgEncoder = exports.encoder = {};\r\n\r\n            var codec = protobuf.codec;\r\n            var constant = protobuf.constants;\r\n            var util = protobuf.util;\r\n\r\n            MsgEncoder.init = function (protos) {\r\n                this.protos = protos || {};\r\n            };\r\n\r\n            MsgEncoder.encode = function (route, msg) {\r\n                //Get protos from protos map use the route as key\r\n                var protos = this.protos[route];\r\n\r\n                //Check msg\r\n                if (!checkMsg(msg, protos)) {\r\n                    return null;\r\n                }\r\n\r\n                //Set the length of the buffer 2 times bigger to prevent overflow\r\n                var length = codec.byteLength(JSON.stringify(msg));\r\n\r\n                //Init buffer and offset\r\n                var buffer = new ArrayBuffer(length);\r\n                var uInt8Array = new Uint8Array(buffer);\r\n                var offset = 0;\r\n\r\n                if (!!protos) {\r\n                    offset = encodeMsg(uInt8Array, offset, protos, msg);\r\n                    if (offset > 0) {\r\n                        return uInt8Array.subarray(0, offset);\r\n                    }\r\n                }\r\n\r\n                return null;\r\n            };\r\n\r\n            /**\r\n             * Check if the msg follow the defination in the protos\r\n             */\r\n            function checkMsg(msg, protos) {\r\n                if (!protos) {\r\n                    return false;\r\n                }\r\n\r\n                for (var name in protos) {\r\n                    var proto = protos[name];\r\n\r\n                    //All required element must exist\r\n                    switch (proto.option) {\r\n                        case 'required' :\r\n                            if (typeof(msg[name]) === 'undefined') {\r\n                                return false;\r\n                            }\r\n                        case 'optional' :\r\n                            if (typeof(msg[name]) !== 'undefined') {\r\n                                var message = protos.__messages[proto.type] || MsgEncoder.protos['message ' + proto.type];\r\n                                if (!!message) {\r\n                                    checkMsg(msg[name], message);\r\n                                }\r\n                            }\r\n                            break;\r\n                        case 'repeated' :\r\n                            //Check nest message in repeated elements\r\n                            var message = protos.__messages[proto.type] || MsgEncoder.protos['message ' + proto.type];\r\n                            if (!!msg[name] && !!message) {\r\n                                for (var i = 0; i < msg[name].length; i++) {\r\n                                    if (!checkMsg(msg[name][i], message)) {\r\n                                        return false;\r\n                                    }\r\n                                }\r\n                            }\r\n                            break;\r\n                    }\r\n                }\r\n\r\n                return true;\r\n            }\r\n\r\n            function encodeMsg(buffer, offset, protos, msg) {\r\n                for (var name in msg) {\r\n                    if (!!protos[name]) {\r\n                        var proto = protos[name];\r\n\r\n                        switch (proto.option) {\r\n                            case 'required' :\r\n                            case 'optional' :\r\n                                offset = writeBytes(buffer, offset, encodeTag(proto.type, proto.tag));\r\n                                offset = encodeProp(msg[name], proto.type, offset, buffer, protos);\r\n                                break;\r\n                            case 'repeated' :\r\n                                if (msg[name].length > 0) {\r\n                                    offset = encodeArray(msg[name], proto, offset, buffer, protos);\r\n                                }\r\n                                break;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                return offset;\r\n            }\r\n\r\n            function encodeProp(value, type, offset, buffer, protos) {\r\n                switch (type) {\r\n                    case 'uInt32':\r\n                        offset = writeBytes(buffer, offset, codec.encodeUInt32(value));\r\n                        break;\r\n                    case 'int32' :\r\n                    case 'sInt32':\r\n                        offset = writeBytes(buffer, offset, codec.encodeSInt32(value));\r\n                        break;\r\n                    case 'float':\r\n                        writeBytes(buffer, offset, codec.encodeFloat(value));\r\n                        offset += 4;\r\n                        break;\r\n                    case 'double':\r\n                        writeBytes(buffer, offset, codec.encodeDouble(value));\r\n                        offset += 8;\r\n                        break;\r\n                    case 'string':\r\n                        var length = codec.byteLength(value);\r\n\r\n                        //Encode length\r\n                        offset = writeBytes(buffer, offset, codec.encodeUInt32(length));\r\n                        //write string\r\n                        codec.encodeStr(buffer, offset, value);\r\n                        offset += length;\r\n                        break;\r\n                    default :\r\n                        var message = protos.__messages[type] || MsgEncoder.protos['message ' + type];\r\n                        if (!!message) {\r\n                            //Use a tmp buffer to build an internal msg\r\n                            var tmpBuffer = new ArrayBuffer(codec.byteLength(JSON.stringify(value)));\r\n                            var length = 0;\r\n\r\n                            length = encodeMsg(tmpBuffer, length, message, value);\r\n                            //Encode length\r\n                            offset = writeBytes(buffer, offset, codec.encodeUInt32(length));\r\n                            //contact the object\r\n                            for (var i = 0; i < length; i++) {\r\n                                buffer[offset] = tmpBuffer[i];\r\n                                offset++;\r\n                            }\r\n                        }\r\n                        break;\r\n                }\r\n\r\n                return offset;\r\n            }\r\n\r\n            /**\r\n             * Encode reapeated properties, simple msg and object are decode differented\r\n             */\r\n            function encodeArray(array, proto, offset, buffer, protos) {\r\n                var i = 0;\r\n\r\n                if (util.isSimpleType(proto.type)) {\r\n                    offset = writeBytes(buffer, offset, encodeTag(proto.type, proto.tag));\r\n                    offset = writeBytes(buffer, offset, codec.encodeUInt32(array.length));\r\n                    for (i = 0; i < array.length; i++) {\r\n                        offset = encodeProp(array[i], proto.type, offset, buffer);\r\n                    }\r\n                } else {\r\n                    for (i = 0; i < array.length; i++) {\r\n                        offset = writeBytes(buffer, offset, encodeTag(proto.type, proto.tag));\r\n                        offset = encodeProp(array[i], proto.type, offset, buffer, protos);\r\n                    }\r\n                }\r\n\r\n                return offset;\r\n            }\r\n\r\n            function writeBytes(buffer, offset, bytes) {\r\n                for (var i = 0; i < bytes.length; i++, offset++) {\r\n                    buffer[offset] = bytes[i];\r\n                }\r\n\r\n                return offset;\r\n            }\r\n\r\n            function encodeTag(type, tag) {\r\n                var value = constant.TYPES[type] || 2;\r\n                return codec.encodeUInt32((tag << 3) | value);\r\n            }\r\n        })('undefined' !== typeof protobuf ? protobuf : module.exports, this);\r\n\r\n        /**\r\n         * decoder module\r\n         */\r\n        (function (exports, global) {\r\n            var protobuf = exports;\r\n            var MsgDecoder = exports.decoder = {};\r\n\r\n            var codec = protobuf.codec;\r\n            var util = protobuf.util;\r\n\r\n            var buffer;\r\n            var offset = 0;\r\n\r\n            MsgDecoder.init = function (protos) {\r\n                this.protos = protos || {};\r\n            };\r\n\r\n            MsgDecoder.setProtos = function (protos) {\r\n                if (!!protos) {\r\n                    this.protos = protos;\r\n                }\r\n            };\r\n\r\n            MsgDecoder.decode = function (route, buf) {\r\n                var protos = this.protos[route];\r\n\r\n                buffer = buf;\r\n                offset = 0;\r\n\r\n                if (!!protos) {\r\n                    return decodeMsg({}, protos, buffer.length);\r\n                }\r\n\r\n                return null;\r\n            };\r\n\r\n            function decodeMsg(msg, protos, length) {\r\n                while (offset < length) {\r\n                    var head = getHead();\r\n                    var type = head.type;\r\n                    var tag = head.tag;\r\n                    var name = protos.__tags[tag];\r\n\r\n                    switch (protos[name].option) {\r\n                        case 'optional' :\r\n                        case 'required' :\r\n                            msg[name] = decodeProp(protos[name].type, protos);\r\n                            break;\r\n                        case 'repeated' :\r\n                            if (!msg[name]) {\r\n                                msg[name] = [];\r\n                            }\r\n                            decodeArray(msg[name], protos[name].type, protos);\r\n                            break;\r\n                    }\r\n                }\r\n\r\n                return msg;\r\n            }\r\n\r\n            /**\r\n             * Test if the given msg is finished\r\n             */\r\n            function isFinish(msg, protos) {\r\n                return (!protos.__tags[peekHead().tag]);\r\n            }\r\n\r\n            /**\r\n             * Get property head from protobuf\r\n             */\r\n            function getHead() {\r\n                var tag = codec.decodeUInt32(getBytes());\r\n\r\n                return {\r\n                    type: tag & 0x7,\r\n                    tag: tag >> 3\r\n                };\r\n            }\r\n\r\n            /**\r\n             * Get tag head without move the offset\r\n             */\r\n            function peekHead() {\r\n                var tag = codec.decodeUInt32(peekBytes());\r\n\r\n                return {\r\n                    type: tag & 0x7,\r\n                    tag: tag >> 3\r\n                };\r\n            }\r\n\r\n            function decodeProp(type, protos) {\r\n                switch (type) {\r\n                    case 'uInt32':\r\n                        return codec.decodeUInt32(getBytes());\r\n                    case 'int32' :\r\n                    case 'sInt32' :\r\n                        return codec.decodeSInt32(getBytes());\r\n                    case 'float' :\r\n                        var float = codec.decodeFloat(buffer, offset);\r\n                        offset += 4;\r\n                        return float;\r\n                    case 'double' :\r\n                        var double = codec.decodeDouble(buffer, offset);\r\n                        offset += 8;\r\n                        return double;\r\n                    case 'string' :\r\n                        var length = codec.decodeUInt32(getBytes());\r\n\r\n                        var str = codec.decodeStr(buffer, offset, length);\r\n                        offset += length;\r\n\r\n                        return str;\r\n                    default :\r\n                        var message = protos.__messages[type] || MsgDecoder.protos['message ' + type];\r\n                        if (!!protos && !!message) {\r\n                            var length = codec.decodeUInt32(getBytes());\r\n                            var msg = {};\r\n                            decodeMsg(msg, message, offset + length);\r\n                            return msg;\r\n                        }\r\n                        break;\r\n                }\r\n            }\r\n\r\n            function decodeArray(array, type, protos) {\r\n                if (util.isSimpleType(type)) {\r\n                    var length = codec.decodeUInt32(getBytes());\r\n\r\n                    for (var i = 0; i < length; i++) {\r\n                        array.push(decodeProp(type));\r\n                    }\r\n                } else {\r\n                    array.push(decodeProp(type, protos));\r\n                }\r\n            }\r\n\r\n            function getBytes(flag) {\r\n                var bytes = [];\r\n                var pos = offset;\r\n                flag = flag || false;\r\n\r\n                var b;\r\n\r\n                do {\r\n                    b = buffer[pos];\r\n                    bytes.push(b);\r\n                    pos++;\r\n                } while (b >= 128);\r\n\r\n                if (!flag) {\r\n                    offset = pos;\r\n                }\r\n                return bytes;\r\n            }\r\n\r\n            function peekBytes() {\r\n                return getBytes(true);\r\n            }\r\n\r\n        })('undefined' !== typeof protobuf ? protobuf : module.exports, this);\r\n\r\n\r\n    });\r\n\r\n    pomeloBuildObj.register(\"pomelonode-pomelo-jsclient-websocket/lib/pomelo-client.js\", function (exports, requirePomelo, module) {\r\n        (function (self) {\r\n            var JS_WS_CLIENT_TYPE = 'js-websocket';\r\n            var JS_WS_CLIENT_VERSION = '0.0.1';\r\n\r\n            var Protocol = self.Protocol;\r\n            var Package = Protocol.Package;\r\n            var Message = Protocol.Message;\r\n            var EventEmitter = self.EventEmitter;\r\n            var protobuf = self.protobuf;\r\n\r\n            var RES_OK = 200;\r\n            var RES_FAIL = 500;\r\n            var RES_OLD_CLIENT = 501;\r\n\r\n            if (typeof Object.create !== 'function') {\r\n                Object.create = function (o) {\r\n                    function F() {\r\n                    }\r\n\r\n                    F.prototype = o;\r\n                    return new F();\r\n                };\r\n            }\r\n\r\n            var root = window;\r\n            var pomelo = Object.create(EventEmitter.prototype); // object extend from object\r\n            root.pomelo = pomelo;\r\n            var socket = null;\r\n            var reqId = 0;\r\n            var callbacks = {};\r\n            var handlers = {};\r\n            //Map from request id to route\r\n            var routeMap = {};\r\n\r\n            var heartbeatInterval = 0;\r\n            var heartbeatTimeout = 0;\r\n            var nextHeartbeatTimeout = 0;\r\n            var gapThreshold = 100;   // heartbeat gap threashold\r\n            var heartbeatId = null;\r\n            var heartbeatTimeoutId = null;\r\n\r\n            var handshakeCallback = null;\r\n\r\n            var handshakeBuffer = {\r\n                'sys': {\r\n                    type: JS_WS_CLIENT_TYPE,\r\n                    version: JS_WS_CLIENT_VERSION\r\n                },\r\n                'user': {}\r\n            };\r\n\r\n            var initCallback = null;\r\n\r\n            pomelo.init = function (params, cb) {\r\n                initCallback = cb;\r\n                var host = params.host;\r\n                var port = params.port;\r\n\r\n                var wsStr = \"ws://\";\r\n\r\n                if (params.wsStr) {\r\n                    wsStr = params.wsStr;\r\n                }\r\n\r\n                var url = wsStr + host;\r\n                if (port) {\r\n                    url += ':' + port;\r\n                }\r\n\r\n                handshakeBuffer.user = params.user;\r\n                handshakeCallback = params.handshakeCallback;\r\n                initWebSocket(url, cb);\r\n            };\r\n\r\n            var initWebSocket = function (url, cb) {\r\n                console.log('connect to ' + url);\r\n                var onopen = function (event) {\r\n                    var obj = Package.encode(Package.TYPE_HANDSHAKE, Protocol.strencode(JSON.stringify(handshakeBuffer)));\r\n                    send(obj);\r\n                };\r\n                var onmessage = function (event) {\r\n                    processPackage(Package.decode(event.data), cb);\r\n                    // new package arrived, update the heartbeat timeout\r\n                    if (heartbeatTimeout) {\r\n                        nextHeartbeatTimeout = Date.now() + heartbeatTimeout;\r\n                    }\r\n                };\r\n                var onerror = function (event) {\r\n                    pomelo.emit('io-error', event);\r\n                    console.warn('socket error: ', JSON.stringify(event));\r\n                };\r\n                var onclose = function (event) {\r\n                    pomelo.emit('close', event);\r\n                    console.warn('socket close: ', JSON.stringify(event));\r\n                    // //尝试修复断线后继续发心跳包后报错\r\n                    // if (heartbeatId) {\r\n                    //     clearTimeout(heartbeatId);\r\n                    //     heartbeatId = null;\r\n                    // }\r\n                    //\r\n                    // if (heartbeatTimeoutId) {\r\n                    //     clearTimeout(heartbeatTimeoutId);\r\n                    //     heartbeatTimeoutId = null;\r\n                    // }\r\n                };\r\n                socket = new WebSocket(url);\r\n                socket.binaryType = 'arraybuffer';\r\n                socket.onopen = onopen;\r\n                socket.onmessage = onmessage;\r\n                socket.onerror = onerror;\r\n                socket.onclose = onclose;\r\n            };\r\n\r\n            pomelo.disconnect = function () {\r\n                if (socket) {\r\n                    if (socket.disconnect) socket.disconnect();\r\n                    if (socket.close) socket.close();\r\n                    console.log('disconnect');\r\n                    socket = null;\r\n                }\r\n\r\n                if (heartbeatId) {\r\n                    clearTimeout(heartbeatId);\r\n                    heartbeatId = null;\r\n                }\r\n                if (heartbeatTimeoutId) {\r\n                    clearTimeout(heartbeatTimeoutId);\r\n                    heartbeatTimeoutId = null;\r\n                }\r\n            };\r\n\r\n            pomelo.request = function (route, msg, cb) {\r\n                if (arguments.length === 2 && typeof msg === 'function') {\r\n                    cb = msg;\r\n                    msg = {};\r\n                } else {\r\n                    msg = msg || {};\r\n                }\r\n                route = route || msg.route;\r\n                if (!route) {\r\n                    return;\r\n                }\r\n\r\n                reqId++;\r\n                /**\r\n                 * 128及其倍数的reqId会导致服务端编解码出现异常,128及其倍数是个坑。绕过。\r\n                 * //pomelo-protocol.js#243\r\n                 *  do{\r\n                        m = parseInt(bytes[offset]);\r\n                        id += (m & 0x7f) << (7 * i);   //这个风骚的位移有bug\r\n                        offset++;\r\n                        i++;\r\n                    }while(m >= 128); \r\n                 * \r\n                 */\r\n                if (reqId % 128 == 0){\r\n                    reqId++;\r\n                }\r\n\r\n                sendMessage(reqId, route, msg);\r\n\r\n                callbacks[reqId] = cb;\r\n                routeMap[reqId] = route;\r\n            };\r\n\r\n            pomelo.notify = function (route, msg) {\r\n                msg = msg || {};\r\n                sendMessage(0, route, msg);\r\n            };\r\n\r\n            pomelo.clearCallback = function () {\r\n                if(!socket) return;\r\n                socket.onopen = null;\r\n                socket.onmessage = null;\r\n                socket.onerror = null;\r\n                socket.onclose = null;\r\n            };\r\n\r\n            pomelo.isConnecting = function () {\r\n                return (socket && socket.readyState === WebSocket.CONNECTING);\r\n            };\r\n\r\n            pomelo.isOpen = function () {\r\n                return (socket && socket.readyState === WebSocket.OPEN);\r\n            };\r\n\r\n            pomelo.isClosed = function () {\r\n                return (socket && socket.readyState === WebSocket.CLOSED);\r\n            };\r\n\r\n            pomelo.isClosing = function () {\r\n                return (socket && socket.readyState === WebSocket.CLOSING);\r\n            };\r\n\r\n            var sendMessage = function (reqId, route, msg) {\r\n                var type = reqId ? Message.TYPE_REQUEST : Message.TYPE_NOTIFY;\r\n\r\n                //compress message by protobuf\r\n                var protos = !!pomelo.data.protos ? pomelo.data.protos.client : {};\r\n                if (!!protos[route]) {\r\n                    msg = protobuf.encode(route, msg);\r\n                } else {\r\n                    msg = Protocol.strencode(JSON.stringify(msg));\r\n                }\r\n\r\n\r\n                var compressRoute = 0;\r\n                if (pomelo.dict && pomelo.dict[route]) {\r\n                    route = pomelo.dict[route];\r\n                    compressRoute = 1;\r\n                }\r\n\r\n                msg = Message.encode(reqId, type, compressRoute, route, msg);\r\n                var packet = Package.encode(Package.TYPE_DATA, msg);\r\n                send(packet);\r\n            };\r\n\r\n            var send = function (packet) {\r\n                if (socket) {\r\n                    socket.send(packet.buffer);\r\n                }\r\n            };\r\n\r\n\r\n            var handler = {};\r\n\r\n            var heartbeat = function (data) {\r\n                if (!heartbeatInterval) {\r\n                    // no heartbeat\r\n                    return;\r\n                }\r\n\r\n                pomelo.emit('heartbeat recv');\r\n\r\n                var obj = Package.encode(Package.TYPE_HEARTBEAT);\r\n                if (heartbeatTimeoutId) {\r\n                    clearTimeout(heartbeatTimeoutId);\r\n                    heartbeatTimeoutId = null;\r\n                }\r\n\r\n                if (heartbeatId) {\r\n                    // already in a heartbeat interval\r\n                    return;\r\n                }\r\n\r\n                heartbeatId = setTimeout(function () {\r\n                    heartbeatId = null;\r\n                    send(obj);\r\n\r\n                    nextHeartbeatTimeout = Date.now() + heartbeatTimeout;\r\n                    heartbeatTimeoutId = setTimeout(heartbeatTimeoutCb, heartbeatTimeout);\r\n                }, heartbeatInterval);\r\n            };\r\n\r\n            var heartbeatTimeoutCb = function () {\r\n                var gap = nextHeartbeatTimeout - Date.now();\r\n                if (gap > gapThreshold) {\r\n                    heartbeatTimeoutId = setTimeout(heartbeatTimeoutCb, gap);\r\n                } else {\r\n                    console.warn('server heartbeat timeout');\r\n                    pomelo.emit('heartbeat timeout');\r\n                    pomelo.disconnect();\r\n                }\r\n            };\r\n\r\n            var handshake = function (data) {\r\n                data = JSON.parse(Protocol.strdecode(data));\r\n                if (data.code === RES_OLD_CLIENT) {\r\n                    pomelo.emit('error', 'client version not fullfill');\r\n                    return;\r\n                }\r\n\r\n                if (data.code !== RES_OK) {\r\n                    pomelo.emit('error', 'handshake fail');\r\n                    return;\r\n                }\r\n\r\n                handshakeInit(data);\r\n\r\n                var obj = Package.encode(Package.TYPE_HANDSHAKE_ACK);\r\n                send(obj);\r\n                if (initCallback) {\r\n                    initCallback(socket);\r\n                    initCallback = null;\r\n                }\r\n            };\r\n\r\n            var onData = function (data) {\r\n                //probuff decode\r\n                var msg = Message.decode(data);\r\n\r\n                if (msg.id > 0) {\r\n                    msg.route = routeMap[msg.id];\r\n                    delete routeMap[msg.id];\r\n                    if (!msg.route) {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                msg.body = deCompose(msg);\r\n\r\n                processMessage(pomelo, msg);\r\n            };\r\n\r\n            var onKick = function (data) {\r\n                var info = JSON.parse(Protocol.strdecode(data));\r\n\r\n                var reason = \"kick\";\r\n                if (info.hasOwnProperty(\"reason\")) {\r\n                    reason = info[\"reason\"];\r\n                }\r\n\r\n                pomelo.emit('onKick', reason);\r\n            };\r\n\r\n            handlers[Package.TYPE_HANDSHAKE] = handshake;\r\n            handlers[Package.TYPE_HEARTBEAT] = heartbeat;\r\n            handlers[Package.TYPE_DATA] = onData;\r\n            handlers[Package.TYPE_KICK] = onKick;\r\n\r\n            var processPackage = function (msg) {\r\n                handlers[msg.type](msg.body);\r\n            };\r\n\r\n            var processMessage = function (pomelo, msg) {\r\n                if (!msg.id) {\r\n                    // server push message\r\n                    pomelo.emit(msg.route, msg);\r\n                    return;\r\n                }\r\n\r\n                //if have a id then find the callback function with the request\r\n                var cb = callbacks[msg.id];\r\n\r\n                delete callbacks[msg.id];\r\n                if (typeof cb !== 'function') {\r\n                    return;\r\n                }\r\n\r\n                cb(msg);\r\n                return;\r\n            };\r\n\r\n            var processMessageBatch = function (pomelo, msgs) {\r\n                for (var i = 0, l = msgs.length; i < l; i++) {\r\n                    processMessage(pomelo, msgs[i]);\r\n                }\r\n            };\r\n\r\n            var deCompose = function (msg) {\r\n                var protos = !!pomelo.data.protos ? pomelo.data.protos.server : {};\r\n                var abbrs = pomelo.data.abbrs;\r\n                var route = msg.route;\r\n\r\n                //Decompose route from dict\r\n                if (msg.compressRoute) {\r\n                    if (!abbrs[route]) {\r\n                        return {};\r\n                    }\r\n\r\n                    route = msg.route = abbrs[route];\r\n                }\r\n                if (!!protos[route]) {\r\n                    return protobuf.decode(route, msg.body);\r\n                } else {\r\n                    return JSON.parse(Protocol.strdecode(msg.body));\r\n                }\r\n\r\n                return msg;\r\n            };\r\n\r\n            var handshakeInit = function (data) {\r\n                if (data.sys && data.sys.heartbeat) {\r\n                    heartbeatInterval = data.sys.heartbeat * 1000;   // heartbeat interval\r\n                    heartbeatTimeout = heartbeatInterval * 2;        // max heartbeat timeout\r\n                } else {\r\n                    heartbeatInterval = 0;\r\n                    heartbeatTimeout = 0;\r\n                }\r\n\r\n                initData(data);\r\n\r\n                if (typeof handshakeCallback === 'function') {\r\n                    handshakeCallback(data.user);\r\n                }\r\n            };\r\n\r\n            //Initilize data used in pomelo client\r\n            var initData = function (data) {\r\n                if (!data || !data.sys) {\r\n                    return;\r\n                }\r\n                pomelo.data = pomelo.data || {};\r\n                var dict = data.sys.dict;\r\n                var protos = data.sys.protos;\r\n\r\n                //Init compress dict\r\n                if (dict) {\r\n                    pomelo.data.dict = dict;\r\n                    pomelo.data.abbrs = {};\r\n\r\n                    for (var route in dict) {\r\n                        pomelo.data.abbrs[dict[route]] = route;\r\n                    }\r\n                }\r\n\r\n                //Init protobuf protos\r\n                if (protos) {\r\n                    pomelo.data.protos = {\r\n                        server: protos.server || {},\r\n                        client: protos.client || {}\r\n                    };\r\n                    if (!!protobuf) {\r\n                        protobuf.init({encoderProtos: protos.client, decoderProtos: protos.server});\r\n                    }\r\n                }\r\n            };\r\n\r\n            module.exports = pomelo;\r\n        })(this);\r\n\r\n    });\r\n\r\n    pomeloBuildObj.register(\"boot/index.js\", function (exports, requirePomelo, module) {\r\n        var Emitter = requirePomelo('emitter');\r\n        this.EventEmitter = Object.create(Emitter);\r\n\r\n        var protocol = requirePomelo('pomelo-protocol');\r\n        this.Protocol = protocol;\r\n\r\n        var protobuf = requirePomelo('pomelo-protobuf');\r\n        this.protobuf = protobuf;\r\n\r\n        var pomelo = requirePomelo('pomelo-jsclient-websocket');\r\n        this.pomelo = pomelo;\r\n\r\n    });\r\n    pomeloBuildObj.alias(\"boot/index.js\", \"pomelo-client/deps/boot/index.js\");\r\n    pomeloBuildObj.alias(\"component-emitter/index.js\", \"boot/deps/emitter/index.js\");\r\n    pomeloBuildObj.alias(\"component-indexof/index.js\", \"component-emitter/deps/indexof/index.js\");\r\n\r\n    pomeloBuildObj.alias(\"NetEase-pomelo-protocol/lib/protocol.js\", \"boot/deps/pomelo-protocol/lib/protocol.js\");\r\n    pomeloBuildObj.alias(\"NetEase-pomelo-protocol/lib/protocol.js\", \"boot/deps/pomelo-protocol/index.js\");\r\n    pomeloBuildObj.alias(\"NetEase-pomelo-protocol/lib/protocol.js\", \"NetEase-pomelo-protocol/index.js\");\r\n\r\n    pomeloBuildObj.alias(\"pomelonode-pomelo-protobuf/lib/client/protobuf.js\", \"boot/deps/pomelo-protobuf/lib/client/protobuf.js\");\r\n    pomeloBuildObj.alias(\"pomelonode-pomelo-protobuf/lib/client/protobuf.js\", \"boot/deps/pomelo-protobuf/index.js\");\r\n    pomeloBuildObj.alias(\"pomelonode-pomelo-protobuf/lib/client/protobuf.js\", \"pomelonode-pomelo-protobuf/index.js\");\r\n\r\n    pomeloBuildObj.alias(\"pomelonode-pomelo-jsclient-websocket/lib/pomelo-client.js\", \"boot/deps/pomelo-jsclient-websocket/lib/pomelo-client.js\");\r\n    pomeloBuildObj.alias(\"pomelonode-pomelo-jsclient-websocket/lib/pomelo-client.js\", \"boot/deps/pomelo-jsclient-websocket/index.js\");\r\n    pomeloBuildObj.alias(\"pomelonode-pomelo-jsclient-websocket/lib/pomelo-client.js\", \"pomelonode-pomelo-jsclient-websocket/index.js\");\r\n\r\n    pomeloBuildObj.requirePomelo(\"boot\");\r\n\r\n    return pomeloBuildObj;\r\n};\r\n\r\nwindow.pomeloBuild = pomeloBuild;\r\n"]}