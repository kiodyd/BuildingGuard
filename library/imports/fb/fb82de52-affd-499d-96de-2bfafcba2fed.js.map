{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\common\\script/assets\\scripts\\common\\script\\uiLogin.js"],"names":["uiPanel","require","cc","Class","extends","properties","startPosition","Node","onLoad","_super","start","window","wx","getSetting","success","res","authSetting","authorize","scope","console","log","getUserInfo","Game","GameManager","nickName","userInfo","avatarUrl","id","getLaunchOptionsSync","query","GLB","canInvate","undefined","uiFunc","openUI","obj","uiTip","getComponent","setData","matchVsInit","fail","nodeDict","on","isClickCd","setTimeout","target","createjs","Tween","get","to","x","y","onEnable","getUserInfoBtn","show","onDisable","hide","clientEvent","off","eventType","joinRoomResponse"],"mappings":"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","file":"uiLogin.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\common\\script","sourcesContent":["var uiPanel = require(\"uiPanel\");\r\ncc.Class({\r\n    extends: uiPanel,\r\n    properties: {\r\n        startPosition: cc.Node\r\n    },\r\n\r\n    onLoad() {\r\n        this._super();\r\n\r\n\r\n    },\r\n\r\n    start() {\r\n\r\n\r\n        if (window.wx) {\r\n\r\n\r\n            wx.getSetting({\r\n                success(res) {\r\n                    if (!res.authSetting['scope.userInfo']) {\r\n                        wx.authorize({\r\n                            scope: 'scope.userInfo',\r\n                            success() {\r\n                                console.log(\"success!\");\r\n                                wx.getUserInfo({\r\n                                    success(res) {\r\n                                        console.log(res);\r\n                                        //此时可进行登录操作\r\n                                        Game.GameManager.nickName = res.userInfo.nickName;\r\n                                        Game.GameManager.avatarUrl = res.userInfo.avatarUrl;\r\n\r\n                                        var id = wx.getLaunchOptionsSync().query.id;\r\n                                        console.log(id);\r\n                                        if (GLB.canInvate && id != undefined) {\r\n                                            uiFunc.openUI(\"uiTip\", function (obj) {\r\n                                                var uiTip = obj.getComponent(\"uiTip\");\r\n                                                if (uiTip) {\r\n                                                    uiTip.setData(\"正在进入游戏中，请稍等...\");\r\n                                                }\r\n                                            });\r\n                                            Game.GameManager.matchVsInit();\r\n                                        }\r\n\r\n                                    },\r\n                                    fail() {\r\n\r\n                                        console.log(\"拒绝收取\")\r\n                                        uiFunc.openUI(\"uiTip\", function (obj) {\r\n                                            var uiTip = obj.getComponent(\"uiTip\");\r\n                                            if (uiTip) {\r\n                                                uiTip.setData(\"请您授权微信信息\");\r\n                                            }\r\n                                        });\r\n                                    },\r\n\r\n                                });\r\n                            },\r\n\r\n                            fail() {\r\n\r\n                                console.log(\"拒绝收取\")\r\n                                uiFunc.openUI(\"uiTip\", function (obj) {\r\n                                    var uiTip = obj.getComponent(\"uiTip\");\r\n                                    if (uiTip) {\r\n                                        uiTip.setData(\"请您授权微信信息\");\r\n                                    }\r\n                                });\r\n                            },\r\n                        })\r\n                    } else {\r\n                        wx.getUserInfo({\r\n                            success(res) {\r\n                                console.log(res);\r\n                                //此时可进行登录操作\r\n                                Game.GameManager.nickName = res.userInfo.nickName;\r\n                                Game.GameManager.avatarUrl = res.userInfo.avatarUrl;\r\n\r\n                                var id = wx.getLaunchOptionsSync().query.id;\r\n                                console.log(id);\r\n                                if (GLB.canInvate && id != undefined) {\r\n\r\n                                    uiFunc.openUI(\"uiTip\", function (obj) {\r\n                                        var uiTip = obj.getComponent(\"uiTip\");\r\n                                        if (uiTip) {\r\n                                            uiTip.setData(\"正在进入游戏中，请稍等...\");\r\n                                        }\r\n                                    });\r\n                                    Game.GameManager.matchVsInit();\r\n                                }\r\n                            },\r\n\r\n                            fail() {\r\n\r\n                                console.log(\"拒绝收取\")\r\n                                uiFunc.openUI(\"uiTip\", function (obj) {\r\n                                    var uiTip = obj.getComponent(\"uiTip\");\r\n                                    if (uiTip) {\r\n                                        uiTip.setData(\"请您授权微信信息\");\r\n                                    }\r\n                                });\r\n                            },\r\n                        });\r\n                    }\r\n                }\r\n            })\r\n\r\n\r\n\r\n            //this.nodeDict[\"start\"].active = false;\r\n            this.nodeDict[\"start\"].on(\"click\", function () {\r\n                if (Game.GameManager.isClickCd) {\r\n                    return;\r\n                }\r\n                Game.GameManager.isClickCd = true;\r\n                setTimeout(function () {\r\n                    Game.GameManager.isClickCd = false;\r\n                }, 1000);\r\n\r\n\r\n                \r\n\r\n                var target = this.nodeDict[\"start\"]\r\n                createjs.Tween.get(target).to({ x: 0 }, 200);\r\n                createjs.Tween.get(target).to({ y: 0 }, 200);\r\n\r\n\r\n                setTimeout(() => {\r\n                    //this.nodeDict['help'].active = true;\r\n\r\n\r\n                    // wx.getSetting({\r\n                    //     success(res) {\r\n                    //         if (res.authSetting['scope.userInfo']) {\r\n                    //             // 已经授权，可以直接调用 getUserInfo 获取头像昵称\r\n                    //             wx.getUserInfo({\r\n                    //                 success(res) {\r\n\r\n                    //                 }\r\n                    //             })\r\n                    //         } else {\r\n                    //             console.log(\"还未授权\");\r\n                    //         }\r\n                    //     }\r\n                    // })\r\n\r\n                    GLB.canInvate = false;\r\n                    Game.GameManager.matchVsInit();\r\n                }, 100)\r\n\r\n\r\n            }, this);\r\n        } else {\r\n\r\n            //this.nodeDict['help'].active = true;\r\n            this.nodeDict[\"start\"].on(\"click\", function () {\r\n                var target = this.nodeDict[\"start\"]\r\n                createjs.Tween.get(target).to({ x: 0 }, 200);\r\n                createjs.Tween.get(target).to({ y: 0 }, 200);\r\n\r\n                setTimeout(() => {\r\n                    GLB.canInvate = false;\r\n                    Game.GameManager.matchVsInit();\r\n                }, 200);\r\n            }, this);\r\n\r\n\r\n        }\r\n    },\r\n\r\n\r\n\r\n    onEnable() {\r\n        if (Game.GameManager.getUserInfoBtn) {\r\n            Game.GameManager.getUserInfoBtn.show();\r\n        }\r\n    },\r\n\r\n    onDisable() {\r\n        if (Game.GameManager.getUserInfoBtn) {\r\n            Game.GameManager.getUserInfoBtn.hide();\r\n        }\r\n        clientEvent.off(clientEvent.eventType.joinRoomResponse, this.joinRoomResponse, this);\r\n    }\r\n});\r\n"]}