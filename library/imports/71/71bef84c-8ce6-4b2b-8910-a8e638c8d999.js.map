{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\common\\script\\basic/assets\\scripts\\common\\script\\basic\\gameManager.js"],"names":["mvs","require","cc","Class","extends","Component","properties","uiLogin","Node","uiCreateRoom","blockInput","Game","GameManager","getComponent","BlockInputEvents","enabled","setTimeout","node","onLoad","game","addPersistRootNode","director","getCollisionManager","getPhysicsManager","clientEvent","init","dataFunc","loadConfigs","view","enableAutoFullScreen","rivalScore","selfScore","gameTime","isRivalLeave","on","eventType","gameOver","leaveRoomNotify","leaveRoom","joinRoomResponse","joinRoomResponseC","network","window","chooseNetworkMode","getRankDataListener","findPlayerByAccountListener","data","status","console","log","uiFunc","openUI","obj","uiTip","setData","roomInfo","roomID","roomUserInfoList","some","x","userId","GLB","userInfo","id","push","userProfile","MAX_PLAYER_COUNT","active","room","joinRoomInit","gameState","GameState","Play","leaveRoomInfo","dispatch","leaveRoomMedNotify","gamePanel","findUI","Over","readyCnt","bind","startGame","None","clearInterval","timeId","loadScene","sendReadyMsg","syncFrame","isRoomOwner","result","engine","setFrameSync","FRAME_RATE","setFrameSyncResponse","rsp","mStatus","matchVsInit","response","initResponse","errorResponse","joinRoomNotify","leaveRoomResponse","joinOverResponse","createRoomResponse","getRoomListResponse","getRoomDetailResponse","getRoomListExResponse","kickPlayerResponse","kickPlayerNotify","registerUserResponse","loginResponse","logoutResponse","sendEventNotify","frameUpdate","networkStateNotify","channel","platform","gameId","appKey","gameVersion","netNotify","owner","userID","state","kickPlayerRsp","roomInfos","joinOverRsp","roomUserInfo","leaveRoomRsp","disconnect","removePersistRootNode","error","msg","logout","registerUser","deviceId","gatewayId","login","token","info","canInvate","isConnected","connect","IP","PORT","send","nickName","avatarUrl","TestID","res","joinRoom","wx","getLaunchOptionsSync","query","lobbyShow","create","CreateRoomInfo","roomName","maxPlayer","mode","canWatch","visibility","roomProperty","createRoom","JSON","stringify","roomId","createRoomInit","cpProto","parse","indexOf","GAME_START_EVENT","playerUserIds","remoteUserIds","userIds","forEach","ids","i","length","sendEvent","action","PLAYER_ROOM_SYNC","GAME_OVER_EVENT","READY","sendRoundStartMsg","ROUND_START","timeUpdate","roundStart","ROUND_STATE","nowState","nowPlayerId","nowPlayer","RoundState","RoundVote","roundVote","RoundEnd","good","split","pop","bad","GameEnv","closeVote","NOW_PLAYER","playerId","number","currentPlayer","PLAYER_READY","playerReady","String","checkStart","PLAYER_Cancel_READY","index","splice","PLAYER_SYNC","playerReadyIds","VOTE_ONE","writeVote","VOTE_END","outs","attentions","voteNums","parseInt","voteEnd","LEVEL_SYNC","levelIndex","levelUpdate","CAMP","camp","NEED_UP","BlockManager","checkNeed","sendEventEx","frameItems","DIRECTION","block","currentBlock","srcUserID","setDirect","direction","GAME_TIME","UPDATE_B","setNeedUp","setIndex","Index","NextIndex","makeBlock","move","setInterval","sendFrameEvent","recvMsg","uiRankPanel","rankArray","playerAccountGet","GAME_NAME"],"mappings":"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","file":"gameManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\common\\script\\basic","sourcesContent":["var mvs = require(\"Matchvs\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        uiLogin: cc.Node,\r\n        uiCreateRoom: cc.Node\r\n    },\r\n\r\n    blockInput() {\r\n        Game.GameManager.getComponent(cc.BlockInputEvents).enabled = true;\r\n        setTimeout(function () {\r\n            Game.GameManager.node.getComponent(cc.BlockInputEvents).enabled = false;\r\n        }, 1000);\r\n    },\r\n\r\n    onLoad() {\r\n        Game.GameManager = this;\r\n        cc.game.addPersistRootNode(this.node);\r\n        cc.director.getCollisionManager().enabled = true;\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        // cc.director.getPhysicsManager().debugDrawFlags = 1;\r\n        clientEvent.init();\r\n        dataFunc.loadConfigs();\r\n        cc.view.enableAutoFullScreen(false);\r\n        this.rivalScore = 0;\r\n        this.selfScore = 0;\r\n        this.gameTime = 0;\r\n        this.isRivalLeave = false;\r\n        clientEvent.on(clientEvent.eventType.gameOver, this.gameOver, this);\r\n        clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoom, this);\r\n        clientEvent.on(clientEvent.eventType.joinRoomResponse, this.joinRoomResponseC, this);\r\n        this.network = window.network;\r\n        this.network.chooseNetworkMode();\r\n        this.getRankDataListener();\r\n        this.findPlayerByAccountListener();\r\n\r\n\r\n        \r\n    },\r\n\r\n    joinRoomResponseC: function (data) {\r\n        if (data.status !== 200) {\r\n            console.log('进入房间失败,异步回调错误码: ' + data.status);\r\n\r\n            uiFunc.openUI(\"uiTip\", function (obj) {\r\n                var uiTip = obj.getComponent(\"uiTip\");\r\n                if (uiTip) {\r\n                    uiTip.setData(\"当前所加入的房间不存在\");\r\n                }\r\n            });\r\n            \r\n        } else {\r\n            console.log('进入房间成功');\r\n            console.log('房间号: ' + data.roomInfo.roomID);\r\n            if (!data.roomUserInfoList.some(function (x) {\r\n                return x.userId === GLB.userInfo.id;\r\n            })) {\r\n                data.roomUserInfoList.push({\r\n                    userId: GLB.userInfo.id,\r\n                    userProfile: \"\"\r\n                });\r\n            }\r\n            // 设置房间最大人数--\r\n\r\n\r\n            GLB.MAX_PLAYER_COUNT = 5;\r\n\r\n\r\n            this.uiCreateRoom.active = true;\r\n            var room = this.uiCreateRoom.getComponent('uiRoom');\r\n            room.joinRoomInit(data.roomUserInfoList, data.roomInfo);\r\n            \r\n            this.node.active = false;\r\n\r\n        }\r\n    },\r\n\r\n    leaveRoom: function (data) {\r\n        if (this.gameState === GameState.Play) {\r\n            if (data.leaveRoomInfo.userId !== GLB.userInfo.id) {\r\n                this.isRivalLeave = true;\r\n            }\r\n            clientEvent.dispatch(clientEvent.eventType.leaveRoomMedNotify, data);\r\n            this.gameOver();\r\n        }\r\n    },\r\n\r\n    gameOver: function () {\r\n        // 打开结算界面--\r\n        var gamePanel = uiFunc.findUI(\"uiGamePanel\");\r\n        if (gamePanel && Game.GameManager.gameState !== GameState.Over) {\r\n            Game.GameManager.gameState = GameState.Over;\r\n            this.readyCnt = 0;\r\n            setTimeout(function () {\r\n                clientEvent.dispatch(clientEvent.eventType.gameOver);\r\n            }.bind(this), 1500);\r\n            setTimeout(function () {\r\n                uiFunc.openUI(\"uiVsResult\");\r\n            }.bind(this), 3000);\r\n        }\r\n    },\r\n\r\n    startGame: function () {\r\n        this.readyCnt = 0;\r\n        this.gameState = GameState.None;\r\n        this.rivalScore = 0;\r\n        this.selfScore = 0;\r\n        this.isRivalLeave = false;\r\n        this.gameTime = GLB.gameTime;\r\n        clearInterval(Game.GameManager.timeId);\r\n        cc.director.loadScene('game_scene', function () {\r\n            this.sendReadyMsg();\r\n            // uiFunc.openUI(\"uiGamePanel\", function () {\r\n            //     this.sendReadyMsg();\r\n            // }.bind(this));\r\n        }.bind(this));\r\n\r\n        if (GLB.syncFrame === true && GLB.isRoomOwner === true) {\r\n            var result = mvs.engine.setFrameSync(GLB.FRAME_RATE);\r\n            if (result !== 0) {\r\n                console.log('设置帧同步率失败,错误码:' + result);\r\n            }\r\n        }\r\n    },\r\n\r\n    setFrameSyncResponse: function (rsp) {\r\n        if (rsp.mStatus !== 200) {\r\n            console.log('设置同步帧率失败，status=' + rsp.status);\r\n        } else {\r\n            console.log('设置同步帧率成功, 帧率为:' + GLB.FRAME_RATE);\r\n        }\r\n    },\r\n\r\n    matchVsInit: function () {\r\n        mvs.response.initResponse = this.initResponse.bind(this);\r\n        mvs.response.errorResponse = this.errorResponse.bind(this);\r\n        mvs.response.joinRoomResponse = this.joinRoomResponse.bind(this);\r\n        mvs.response.joinRoomNotify = this.joinRoomNotify.bind(this);\r\n        mvs.response.leaveRoomResponse = this.leaveRoomResponse.bind(this);\r\n        mvs.response.leaveRoomNotify = this.leaveRoomNotify.bind(this);\r\n        mvs.response.joinOverResponse = this.joinOverResponse.bind(this);\r\n        mvs.response.createRoomResponse = this.createRoomResponse.bind(this);\r\n        mvs.response.getRoomListResponse = this.getRoomListResponse.bind(this);\r\n        mvs.response.getRoomDetailResponse = this.getRoomDetailResponse.bind(this);\r\n        mvs.response.getRoomListExResponse = this.getRoomListExResponse.bind(this);\r\n        mvs.response.kickPlayerResponse = this.kickPlayerResponse.bind(this);\r\n        mvs.response.kickPlayerNotify = this.kickPlayerNotify.bind(this);\r\n        mvs.response.registerUserResponse = this.registerUserResponse.bind(this);\r\n        mvs.response.loginResponse = this.loginResponse.bind(this); // 用户登录之后的回调\r\n        mvs.response.logoutResponse = this.logoutResponse.bind(this); // 用户登录之后的回调\r\n        mvs.response.sendEventNotify = this.sendEventNotify.bind(this);\r\n        mvs.response.frameUpdate = this.frameUpdate.bind(this);\r\n        mvs.response.setFrameSyncResponse = this.setFrameSyncResponse.bind(this);\r\n        mvs.response.networkStateNotify = this.networkStateNotify.bind(this);\r\n\r\n        //var result = mvs.engine.init(mvs.response, GLB.channel, GLB.platform, GLB.gameId);\r\n        var result = mvs.engine.init(mvs.response, GLB.channel, GLB.platform, GLB.gameId, GLB.appKey, GLB.gameVersion);\r\n        if (result !== 0) {\r\n            console.log('初始化失败,错误码:' + result);\r\n        }\r\n\r\n        Game.GameManager.blockInput();\r\n    },\r\n\r\n    networkStateNotify: function (netNotify) {\r\n        console.log(\"netNotify\");\r\n        console.log(\"netNotify.owner:\" + netNotify.owner);\r\n        if (netNotify.userID !== GLB.userInfo.id) {\r\n            GLB.isRoomOwner = true;\r\n        }\r\n        console.log(\"玩家：\" + netNotify.userID + \" state:\" + netNotify.state);\r\n        if (netNotify.userID !== GLB.userInfo.id) {\r\n            this.isRivalLeave = true;\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomMedNotify, netNotify);\r\n        this.gameOver();\r\n    },\r\n\r\n    kickPlayerNotify: function (kickPlayerNotify) {\r\n        var data = {\r\n            kickPlayerNotify: kickPlayerNotify\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerNotify, data);\r\n    },\r\n\r\n    kickPlayerResponse: function (kickPlayerRsp) {\r\n        if (kickPlayerRsp.status !== 200) {\r\n            console.log(\"失败kickPlayerRsp:\" + kickPlayerRsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            kickPlayerRsp: kickPlayerRsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerResponse, data);\r\n    },\r\n\r\n    getRoomListExResponse: function (rsp) {\r\n        if (rsp.status !== 200) {\r\n            console.log(\"失败 rsp:\" + rsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            rsp: rsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.getRoomListExResponse, data);\r\n    },\r\n\r\n    getRoomDetailResponse: function (rsp) {\r\n        if (rsp.status !== 200) {\r\n            console.log(\"失败 rsp:\" + rsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            rsp: rsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.getRoomDetailResponse, data);\r\n    },\r\n\r\n    getRoomListResponse: function (status, roomInfos) {\r\n        if (status !== 200) {\r\n            console.log(\"失败 status:\" + status);\r\n            return;\r\n        }\r\n        var data = {\r\n            status: status,\r\n            roomInfos: roomInfos\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.getRoomListResponse, data);\r\n    },\r\n\r\n    createRoomResponse: function (rsp) {\r\n        if (rsp.status !== 200) {\r\n            console.log(\"失败 createRoomResponse:\" + rsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            rsp: rsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.createRoomResponse, data);\r\n    },\r\n\r\n    joinOverResponse: function (joinOverRsp) {\r\n        if (joinOverRsp.status !== 200) {\r\n            console.log(\"失败 joinOverRsp:\" + joinOverRsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            joinOverRsp: joinOverRsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.joinOverResponse, data);\r\n    },\r\n\r\n    joinRoomResponse: function (status, roomUserInfoList, roomInfo) {\r\n        if (status !== 200) {\r\n            console.log(\"失败 joinRoomResponse:\" + status);\r\n            return;\r\n        }\r\n        var data = {\r\n            status: status,\r\n            roomUserInfoList: roomUserInfoList,\r\n            roomInfo: roomInfo\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.joinRoomResponse, data);\r\n    },\r\n\r\n    joinRoomNotify: function (roomUserInfo) {\r\n        var data = {\r\n            roomUserInfo: roomUserInfo\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.joinRoomNotify, data);\r\n    },\r\n\r\n    leaveRoomResponse: function (leaveRoomRsp) {\r\n        if (leaveRoomRsp.status !== 200) {\r\n            console.log(\"失败 leaveRoomRsp:\" + leaveRoomRsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            leaveRoomRsp: leaveRoomRsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomResponse, data);\r\n    },\r\n\r\n    leaveRoomNotify: function (leaveRoomInfo) {\r\n        var data = {\r\n            leaveRoomInfo: leaveRoomInfo\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomNotify, data);\r\n    },\r\n\r\n    logoutResponse: function (status) {\r\n        Game.GameManager.network.disconnect();\r\n        console.log(\"reload lobby\");\r\n        cc.game.removePersistRootNode(this.node);\r\n        cc.director.loadScene('lobby');\r\n    },\r\n\r\n    errorResponse: function (error, msg) {\r\n        if (error === 1001 || error === 0) {\r\n            uiFunc.openUI(\"uiTip\", function (obj) {\r\n                var uiTip = obj.getComponent(\"uiTip\");\r\n                if (uiTip) {\r\n                    uiTip.setData(\"网络断开连接\");\r\n                }\r\n            });\r\n            setTimeout(function () {\r\n                mvs.engine.logout(\"\");\r\n                cc.game.removePersistRootNode(this.node);\r\n                cc.director.loadScene('lobby');\r\n            }.bind(this), 2500);\r\n        }\r\n        console.log(\"错误信息：\" + error);\r\n        console.log(\"错误信息：\" + msg);\r\n    },\r\n\r\n    initResponse: function () {\r\n        console.log('初始化成功，开始注册用户');\r\n        var result = mvs.engine.registerUser();\r\n        if (result !== 0) {\r\n            console.log('注册用户失败，错误码:' + result);\r\n        } else {\r\n            console.log('注册用户成功');\r\n        }\r\n    },\r\n\r\n    registerUserResponse: function (userInfo) {\r\n        var deviceId = 'abcdef';\r\n        var gatewayId = 0;\r\n        GLB.userInfo = userInfo;\r\n\r\n        console.log('开始登录,用户Id:' + userInfo.id)\r\n\r\n        /*var result = mvs.engine.login(\r\n            userInfo.id, userInfo.token,\r\n            GLB.gameId, GLB.gameVersion,\r\n            GLB.appKey, GLB.secret,\r\n            deviceId, gatewayId\r\n        );*/\r\n        var result = mvs.engine.login(userInfo.id, userInfo.token, deviceId);\r\n        if (result !== 0) {\r\n            console.log('登录失败,错误码:' + result);\r\n        }\r\n    },\r\n\r\n    loginResponse: function (info) {\r\n        if (info.status !== 200) {\r\n            console.log('登录失败,异步回调错误码:' + info.status);\r\n        } else {\r\n            console.log('登录成功');\r\n            if(GLB.canInvate){\r\n                //var res;\r\n\r\n                // wx.getSetting({\r\n                //     success(res) {\r\n                //         if (!res.authSetting['scope.userInfo']) {\r\n                //             wx.authorize({\r\n                //                 scope: 'scope.userInfo',\r\n                //                 success() {\r\n                //                     console.log(\"success!\");\r\n                //                 }\r\n                //             })\r\n                //         }\r\n                //     }\r\n                // })\r\n\r\n                // wx.getSetting({\r\n                //     success(res) {\r\n                //         if (res.authSetting['scope.userInfo']) {\r\n                //             // 已经授权，可以直接调用 getUserInfo 获取头像昵称\r\n                //             wx.getUserInfo({\r\n                //                 success(res) {\r\n                //                     Game.GameManager.nickName = res.userInfo.nickName;\r\n                //                     Game.GameManager.avatarUrl = res.userInfo.avatarUrl;\r\n                //                 }\r\n                //             })\r\n                //         } else {\r\n                //             console.log(\"还未授权\");\r\n                //         }\r\n                //     }\r\n                // })\r\n                \r\n                //Game.GameManager.loginServer();\r\n\r\n\r\n                if (!Game.GameManager.network.isConnected()) {\r\n                    Game.GameManager.network.connect(GLB.IP, GLB.PORT, function () {\r\n                        Game.GameManager.network.send(\"connector.entryHandler.login\", {\r\n                            \"account\": GLB.userInfo.id + \"\",\r\n                            \"channel\": \"0\",\r\n                            \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\r\n                            \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\r\n                        });\r\n                    });\r\n                }\r\n\r\n                setTimeout(() => {\r\n                    if(GLB.TestID){\r\n                        //测试使用\r\n                        res = mvs.engine.joinRoom(GLB.TestID, \"joinRoomSpecial\");\r\n                        \r\n                    }else if(window.wx){\r\n                        \r\n                        res = mvs.engine.joinRoom(wx.getLaunchOptionsSync().query.id, \"joinRoomSpecial\");\r\n                    }\r\n                    console.log(res);\r\n                    if(res !== 0 ){\r\n                        uiFunc.openUI(\"uiTip\", function (obj) {\r\n                            var uiTip = obj.getComponent(\"uiTip\");\r\n                            if (uiTip) {\r\n                                uiTip.setData(\"当前所加入的房间不存在\");\r\n                            }\r\n                        });\r\n                    }\r\n                }, 1000);\r\n                \r\n\r\n                \r\n            }else{\r\n\r\n                this.lobbyShow();\r\n            }\r\n        }\r\n    },\r\n\r\n    lobbyShow: function () {\r\n        clientEvent.on(clientEvent.eventType.createRoomResponse, this.createRoomResponse, this);\r\n\r\n        Game.GameManager.blockInput();\r\n\r\n        var create = new mvs.CreateRoomInfo();\r\n        create.roomName = Game.GameManager.nickName + \"的房间\";\r\n        GLB.MAX_PLAYER_COUNT = 5;\r\n        create.maxPlayer = GLB.MAX_PLAYER_COUNT;\r\n        create.mode = 0;\r\n        create.canWatch = 0;\r\n        create.visibility = 1;\r\n        create.roomProperty = GLB.MAX_PLAYER_COUNT;\r\n        var result = mvs.engine.createRoom(create, { maxPlayer: GLB.MAX_PLAYER_COUNT });\r\n\r\n        if (result !== 0) {\r\n            console.log('创建房间失败,错误码:' + result);\r\n        }\r\n\r\n    },\r\n\r\n    createRoomResponse: function (data) {\r\n        var status = data.status;\r\n        if (status !== 200) {\r\n            console.log('创建房间失败,异步回调错误码: ' + status);\r\n        } else {\r\n            console.log('创建房间成功:' + JSON.stringify(data));\r\n            console.log('房间号: ' + data.roomID);\r\n            GLB.roomId = data.roomID;\r\n\r\n            this.uiLogin.active = false;\r\n            this.uiCreateRoom.active = true;\r\n\r\n\r\n            var room = this.uiCreateRoom.getComponent('uiRoom');\r\n            room.createRoomInit(data);\r\n\r\n        }\r\n    },\r\n\r\n    // 玩家行为通知--\r\n    sendEventNotify: function (info) {\r\n        console.log(info);\r\n        var cpProto = JSON.parse(info.cpProto);\r\n        if (info.cpProto.indexOf(GLB.GAME_START_EVENT) >= 0) {\r\n            GLB.playerUserIds = [GLB.userInfo.id];\r\n            var remoteUserIds = JSON.parse(info.cpProto).userIds;\r\n            remoteUserIds.forEach(function (id) {\r\n                if (GLB.userInfo.id !== id) {\r\n                    GLB.playerUserIds.push(id);\r\n                }\r\n            });\r\n\r\n            //房主同步房间内每个人玩家列表顺序\r\n            if (GLB.isRoomOwner) {\r\n                let ids = \"\";\r\n                for (let i = 0; i < GLB.playerUserIds.length; i++) {\r\n                    ids += (GLB.playerUserIds[i] + \",\");\r\n                }\r\n                mvs.engine.sendEvent(JSON.stringify({\r\n                    action: GLB.PLAYER_ROOM_SYNC,\r\n                    playerUserIds: ids\r\n                }));\r\n\r\n            }\r\n\r\n            this.startGame();\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.GAME_OVER_EVENT) >= 0) {\r\n            this.gameOver();\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.READY) >= 0) {\r\n            this.readyCnt++;\r\n            if (GLB.isRoomOwner && this.readyCnt >= GLB.playerUserIds.length) {\r\n                this.sendRoundStartMsg();\r\n            }\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.ROUND_START) >= 0) {\r\n            setTimeout(function () {\r\n                \r\n                this.timeUpdate();\r\n            }.bind(this), 2000);\r\n            clientEvent.dispatch(clientEvent.eventType.roundStart);\r\n\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.ROUND_STATE) >= 0) {\r\n            GLB.nowState = cpProto.state;\r\n            GLB.nowPlayerId = null;\r\n            GLB.nowPlayer = -1;\r\n\r\n            if (cpProto.state === RoundState.RoundVote) {\r\n                clientEvent.dispatch(clientEvent.eventType.roundVote);\r\n            }else if(cpProto.state === RoundState.RoundEnd){\r\n            \r\n\r\n                let good = cpProto.good;\r\n                good = good.split(\",\");\r\n                good.pop();\r\n                GLB.good = good;\r\n\r\n                let bad = cpProto.bad;\r\n                bad = bad.split(\",\");\r\n                bad.pop();\r\n                GLB.bad = bad;\r\n\r\n                console.log(GLB.good);\r\n                console.log(GLB.bad);\r\n\r\n                clientEvent.dispatch(clientEvent.eventType.gameOver);\r\n            }\r\n            else{\r\n                Game.GameEnv.closeVote();\r\n                uiFunc.openUI(\"uiTip\", function (obj) {\r\n                    var uiTip = obj.getComponent(\"uiTip\");\r\n                    if (uiTip) {\r\n                        uiTip.setData(\"第\" + GLB.nowState + \"轮\");\r\n                    }\r\n                });\r\n            }\r\n            \r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.NOW_PLAYER) >= 0) {\r\n            GLB.nowPlayerId = cpProto.playerId;\r\n            GLB.nowPlayer = cpProto.number;\r\n            Game.GameEnv.currentPlayer();\r\n        }\r\n\r\n\r\n        if (info.cpProto.indexOf(GLB.PLAYER_READY) >= 0) {\r\n            GLB.playerReady.push(String(cpProto.playerId));\r\n            clientEvent.dispatch(clientEvent.eventType.checkStart);\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.PLAYER_Cancel_READY) >= 0) {\r\n            let index = GLB.playerReady.indexOf(String(cpProto.playerId));\r\n            if (index !== -1) {\r\n\r\n                GLB.playerReady.splice(index, 1);\r\n            }\r\n        }\r\n\r\n\r\n        if (info.cpProto.indexOf(GLB.PLAYER_SYNC) >= 0) {\r\n            let ids = cpProto.playerReadyIds;\r\n            ids = ids.split(\",\");\r\n            ids.pop();\r\n            GLB.playerReady = ids;\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.PLAYER_ROOM_SYNC) >= 0) {\r\n            let ids = cpProto.playerUserIds;\r\n            ids = ids.split(\",\");\r\n            ids.pop();\r\n            GLB.playerUserIds = ids;\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.VOTE_ONE) >= 0) {\r\n            clientEvent.dispatch(clientEvent.eventType.writeVote, cpProto.playerId);\r\n        }\r\n\r\n\r\n        if (info.cpProto.indexOf(GLB.VOTE_END) >= 0) {\r\n            let outs = cpProto.outs;\r\n            let attentions = cpProto.attentions;\r\n            let voteNums = cpProto.voteNums;\r\n            outs = outs.split(\",\");\r\n            outs.pop();\r\n\r\n            attentions = attentions.split(\",\");\r\n            attentions.pop();\r\n\r\n            voteNums = voteNums.split(\",\");\r\n            voteNums.pop();\r\n            Game.GameEnv.voteNums[\"p1\"] = parseInt(voteNums[0]);\r\n            Game.GameEnv.voteNums[\"p2\"] = parseInt(voteNums[1]);\r\n            Game.GameEnv.voteNums[\"p3\"] = parseInt(voteNums[2]);\r\n            Game.GameEnv.voteNums[\"p4\"] = parseInt(voteNums[3]);\r\n            Game.GameEnv.voteNums[\"p5\"] = parseInt(voteNums[4]);\r\n\r\n            Game.GameEnv.voteEnd(outs, attentions);\r\n        }\r\n\r\n        if(info.cpProto.indexOf(GLB.LEVEL_SYNC) >= 0){\r\n            GLB.levelIndex = cpProto.levelIndex;\r\n            clientEvent.dispatch(clientEvent.eventType.levelUpdate);\r\n        }\r\n\r\n        if(info.cpProto.indexOf(GLB.CAMP) >= 0){\r\n            GLB.camp = cpProto.camp;\r\n            switch(GLB.camp){\r\n                case 0:\r\n                    console.log(\"保卫者\");\r\n                    break;\r\n                case 1:\r\n                    console.log(\"破坏者\");\r\n                    break;\r\n                default:\r\n                    console.log(\"阵营分配错误\");\r\n            }\r\n\r\n        }\r\n\r\n        if(info.cpProto.indexOf(GLB.NEED_UP)>=0){\r\n            Game.BlockManager.checkNeed(cpProto.playerId);\r\n        }\r\n    },\r\n\r\n    sendReadyMsg: function () {\r\n        var msg = { action: GLB.READY };\r\n        this.sendEventEx(msg);\r\n    },\r\n\r\n    sendRoundStartMsg: function () {\r\n        var msg = { action: GLB.ROUND_START };\r\n        this.sendEventEx(msg);\r\n    },\r\n\r\n    frameUpdate: function (rsp) {\r\n        for (var i = 0; i < rsp.frameItems.length; i++) {\r\n            if (Game.GameManager.gameState === GameState.Over) {\r\n                return;\r\n            }\r\n            var info = rsp.frameItems[i];\r\n            var cpProto = JSON.parse(info.cpProto);\r\n            if (info.cpProto.indexOf(GLB.DIRECTION) >= 0) {\r\n                var block = Game.BlockManager.currentBlock.getComponent(\"block\")\r\n                if (GLB.userInfo.id === info.srcUserID) {\r\n                    block.setDirect(cpProto.direction);\r\n                } else {\r\n                    block.setDirect(cpProto.direction);\r\n                }\r\n            }\r\n\r\n            // if (info.cpProto.indexOf(GLB.FIRE_ANIM) >= 0) {\r\n            //     if (GLB.userInfo.id === info.srcUserID) {\r\n            //         Game.PlayerManager.self.firePreAnim();\r\n            //     } else {\r\n            //         Game.PlayerManager.rival.firePreAnim();\r\n            //     }\r\n            // }\r\n\r\n            // if (info.cpProto.indexOf(GLB.FIRE_EVENT) >= 0) {\r\n            //     if (GLB.userInfo.id === info.srcUserID) {\r\n            //         Game.PlayerManager.self.fireNotify(cpProto.speed);\r\n            //     } else {\r\n            //         Game.PlayerManager.rival.fireNotify(cpProto.speed);\r\n            //     }\r\n            // }\r\n\r\n            if (info.cpProto.indexOf(GLB.GAME_TIME) >= 0) {\r\n                this.gameTime--;\r\n                if (this.gameTime < 0) {\r\n                    this.gameTime = 0;\r\n                }\r\n            }\r\n\r\n            if (info.cpProto.indexOf(GLB.UPDATE_B) >= 0) {\r\n                Game.BlockManager.setNeedUp();\r\n                Game.BlockManager.setIndex(cpProto.Index,cpProto.NextIndex);\r\n\r\n                //Game.BlockManager.setNowPlayerId(cpProto.ID);\r\n\r\n            }\r\n\r\n            // if (info.cpProto.indexOf(GLB.GOAL_EVENT) >= 0) {\r\n            //     // cpProto.playerId 为受伤方id--\r\n            //     if (GLB.userInfo.id === cpProto.playerId) {\r\n            //         Game.PlayerManager.self.hitNotify();\r\n            //         this.rivalScore++;\r\n            //     } else {\r\n            //         Game.PlayerManager.rival.hitNotify();\r\n            //         this.selfScore++;\r\n            //     }\r\n            //     clientEvent.dispatch(clientEvent.eventType.score);\r\n            // }\r\n        }\r\n\r\n\r\n        if (Game.BlockManager) {\r\n            // if (Math.abs(Game.PlayerManager.self.targetPosX - Game.PlayerManager.rival.targetPosX) < GLB.playerMinDistance) {\r\n            //     if (Game.PlayerManager.self.targetPosX < Game.PlayerManager.rival.targetPosX) {\r\n            //         Game.PlayerManager.self.targetPosX -= GLB.bounceDistance;\r\n            //         Game.PlayerManager.rival.targetPosX += GLB.bounceDistance;\r\n            //     } else {\r\n            //         Game.PlayerManager.self.targetPosX += GLB.bounceDistance;\r\n            //         Game.PlayerManager.rival.targetPosX -= GLB.bounceDistance;\r\n            //     }\r\n            // }\r\n\r\n            Game.BlockManager.makeBlock();\r\n            if (Game.BlockManager.currentBlock) {\r\n                Game.BlockManager.currentBlock.getComponent(\"block\").move();\r\n            }\r\n\r\n            //Game.PlayerManager.rival.move();\r\n\r\n        }\r\n\r\n\r\n    },\r\n\r\n    timeUpdate: function () {\r\n        clearInterval(Game.GameManager.timeId);\r\n        Game.GameManager.timeId = setInterval(function () {\r\n            if (!this || !this.node) {\r\n                return;\r\n            }\r\n            if (GLB.isRoomOwner) {\r\n                if (Game.GameManager.gameTime <= 0 || Game.GameManager.gameState === GameState.Over) {\r\n                    clearInterval(Game.GameManager.timeId);\r\n                    Game.GameManager.sendEventEx({ action: GLB.GAME_OVER_EVENT });\r\n                } else {\r\n                    mvs.engine.sendFrameEvent(JSON.stringify({\r\n                        action: GLB.GAME_TIME,\r\n                    }));\r\n                }\r\n\r\n            } else {\r\n                if (Game.GameManager.gameTime <= 0 || Game.GameManager.gameState === GameState.Over) {\r\n                    clearInterval(Game.GameManager.timeId);\r\n                }\r\n            }\r\n        }.bind(this), 1000);\r\n    },\r\n\r\n    getRankDataListener: function () {\r\n        this.network.on(\"connector.rankHandler.getRankData\", function (recvMsg) {\r\n            uiFunc.openUI(\"uiRankPanelVer\", function (obj) {\r\n                var uiRankPanel = obj.getComponent(\"uiRankPanel\");\r\n                uiRankPanel.setData(recvMsg.rankArray);\r\n            });\r\n        }.bind(this));\r\n    },\r\n\r\n    findPlayerByAccountListener: function () {\r\n        this.network.on(\"connector.entryHandler.findPlayerByAccount\", function (recvMsg) {\r\n            clientEvent.dispatch(clientEvent.eventType.playerAccountGet, recvMsg);\r\n        });\r\n    },\r\n\r\n    loginServer: function () {\r\n        if (!this.network.isConnected()) {\r\n            this.network.connect(GLB.IP, GLB.PORT, function () {\r\n                this.network.send(\"connector.entryHandler.login\", {\r\n                    \"account\": GLB.userInfo.id + \"\",\r\n                    \"channel\": \"0\",\r\n                    \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\r\n                    \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\r\n                });\r\n                setTimeout(function () {\r\n                    this.network.send(\"connector.rankHandler.updateScore\", {\r\n                        \"account\": GLB.userInfo.id + \"\",\r\n                        \"game\": GLB.GAME_NAME\r\n                    });\r\n                }.bind(this), 500);\r\n            }.bind(this)\r\n            );\r\n        } else {\r\n            this.network.send(\"connector.rankHandler.updateScore\", {\r\n                \"account\": GLB.userInfo.id + \"\",\r\n                \"game\": GLB.GAME_NAME\r\n            });\r\n        }\r\n    },\r\n\r\n    userInfoReq: function (userId) {\r\n        if (!Game.GameManager.network.isConnected()) {\r\n            Game.GameManager.network.connect(GLB.IP, GLB.PORT, function () {\r\n                Game.GameManager.network.send(\"connector.entryHandler.login\", {\r\n                    \"account\": GLB.userInfo.id + \"\",\r\n                    \"channel\": \"0\",\r\n                    \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\r\n                    \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\r\n                });\r\n                setTimeout(function () {\r\n                    Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\r\n                        \"account\": userId + \"\",\r\n                    });\r\n                }, 200);\r\n            }\r\n            );\r\n        } else {\r\n            Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\r\n                \"account\": userId + \"\",\r\n            });\r\n        }\r\n    },\r\n\r\n    sendEventEx: function (msg) {\r\n        var result = mvs.engine.sendEventEx(0, JSON.stringify(msg), 0, GLB.playerUserIds);\r\n        if (result.result !== 0) {\r\n            console.log(msg.action, result.result);\r\n        }\r\n    },\r\n\r\n    \r\n    \r\n\r\n    \r\n\r\n\r\n\r\n\r\n});\r\n"]}