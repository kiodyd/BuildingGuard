{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\common\\script/assets\\scripts\\common\\script\\uiRoom.js"],"names":["uiPanel","require","mvs","cc","Class","extends","properties","help","Node","onLoad","_super","active","players","roomId","roomInfo","owner","playerPrefab","nodeDict","on","readyGame","inviteFriend","isPrepared","prepared","Color","noprepared","clientEvent","eventType","joinRoomNotify","leaveRoomResponse","leaveRoomNotify","joinOverResponse","leaveRoomMedNotify","levelChangeSync","levelUpdate","checkStart","i","GLB","MAX_PLAYER_COUNT","temp","instantiate","parent","roomUserInfo","getComponent","init","push","data","isRoomOwner","ids","playerReady","length","engine","sendEventEx","JSON","stringify","action","PLAYER_SYNC","playerReadyIds","userId","count","j","setData","ownerId","result","joinOver","console","log","leaveRoomRsp","status","uiFunc","closeUI","node","name","destroy","userID","userInfo","id","refreshStartBtn","leaveRoomInfo","quit","leaveRoom","color","sendEvent","PLAYER_READY","playerId","String","PLAYER_Cancel_READY","index","indexOf","splice","createRoomInit","rsp","roomID","joinRoomInit","roomUserInfoList","sort","a","b","PageView","enabled","url","raw","window","wx","shareAppMessage","title","imageUrl","query","complete","arguments","success","shareTickets","groupMsgInfos","LEVEL_SYNC","levelIndex","tagetPosX","target","createjs","Tween","get","to","x","call","handleComplete","onDestroy","off","userIds","tempIds","playerCnt","includes","playerUserIds","len","Math","floor","random","CAMP","camp","z","good","bad","setTimeout","msg","GAME_START_EVENT","Game","GameManager"],"mappings":"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","file":"uiRoom.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\common\\script","sourcesContent":["var uiPanel = require(\"uiPanel\");\r\nvar mvs = require(\"Matchvs\");\r\ncc.Class({\r\n    extends: uiPanel,\r\n    properties: {\r\n        help:cc.Node,\r\n    },\r\n\r\n\r\n\r\n\r\n    onLoad() {\r\n        this._super();\r\n\r\n        this.help.active = true;\r\n        this.players = [];\r\n        this.roomId = 0;\r\n        this.roomInfo = null;\r\n        this.owner = 0;\r\n        this.playerPrefab = this.nodeDict[\"player\"];\r\n        this.playerPrefab.active = false;\r\n        //this.nodeDict[\"startGame\"].on(\"click\", this.startGame, this);\r\n        this.nodeDict[\"prepare\"].on(\"click\", this.readyGame, this);\r\n        this.nodeDict['invite'].on(\"click\", this.inviteFriend, this);\r\n\r\n        this.isPrepared = false;//是否准备\r\n        this.prepared = new cc.Color(153, 153, 153);//准备时的颜色\r\n        this.noprepared = new cc.Color(255, 255, 255);//未准备时的颜色\r\n\r\n\r\n        clientEvent.on(clientEvent.eventType.joinRoomNotify, this.joinRoomNotify, this);\r\n        clientEvent.on(clientEvent.eventType.leaveRoomResponse, this.leaveRoomResponse, this);\r\n        clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoomNotify, this);\r\n        //clientEvent.on(clientEvent.eventType.kickPlayerResponse, this.kickPlayerResponse, this);\r\n        //clientEvent.on(clientEvent.eventType.kickPlayerNotify, this.kickPlayerNotify, this);\r\n        clientEvent.on(clientEvent.eventType.joinOverResponse, this.joinOverResponse, this);\r\n        clientEvent.on(clientEvent.eventType.leaveRoomMedNotify, this.leaveRoomMedNotify, this);\r\n        clientEvent.on(clientEvent.eventType.levelChangeSync, this.levelChangeSync, this);\r\n        clientEvent.on(clientEvent.eventType.levelUpdate, this.levelUpdate, this);\r\n        clientEvent.on(clientEvent.eventType.checkStart, this.checkStart, this);\r\n\r\n\r\n        for (var i = 0; i < GLB.MAX_PLAYER_COUNT; i++) {\r\n            var temp = cc.instantiate(this.playerPrefab);\r\n            temp.active = true;\r\n            temp.parent = this.nodeDict[\"玩家\"];\r\n            var roomUserInfo = temp.getComponent('roomUserInfo');\r\n            roomUserInfo.init();\r\n            this.players.push(roomUserInfo);\r\n        }\r\n\r\n    },\r\n\r\n    // kickPlayerResponse: function(data) {\r\n    //     for (var j = 0; j < this.players.length; j++) {\r\n    //         if (this.players[j].userId === data.kickPlayerRsp.userID) {\r\n    //             this.players[j].init();\r\n    //             break;\r\n    //         }\r\n    //     }\r\n    //     if (GLB.userInfo.id === data.kickPlayerRsp.userID) {\r\n    //         GLB.isRoomOwner = false;\r\n    //         uiFunc.closeUI(this.node.name);\r\n    //         this.node.destroy();\r\n    //     }\r\n    // },\r\n\r\n    // kickPlayerNotify: function(data) {\r\n    //     for (var j = 0; j < this.players.length; j++) {\r\n    //         if (this.players[j].userId === data.kickPlayerNotify.userId) {\r\n    //             this.players[j].init();\r\n    //             break;\r\n    //         }\r\n    //     }\r\n\r\n    //     if (GLB.userInfo.id === data.kickPlayerNotify.userId) {\r\n    //         GLB.isRoomOwner = false;\r\n    //         uiFunc.closeUI(this.node.name);\r\n    //         this.node.destroy();\r\n    //     }\r\n    // },\r\n\r\n\r\n\r\n\r\n    joinRoomNotify: function (data) {\r\n\r\n        if (GLB.isRoomOwner) {\r\n            let ids = \"\";\r\n            for (let i = 0; i < GLB.playerReady.length; i++) {\r\n                ids += (GLB.playerReady[i] + \",\");\r\n            }\r\n            mvs.engine.sendEventEx(0, JSON.stringify({\r\n                action: GLB.PLAYER_SYNC,\r\n                playerReadyIds: ids\r\n            }), 0, [data.roomUserInfo.userId]);\r\n\r\n            this.levelChangeSync();\r\n\r\n        }\r\n\r\n        var count = 0;\r\n        for (var j = 0; j < this.players.length; j++) {\r\n            count++;\r\n            if (this.players[j].userId === 0) {\r\n                this.players[j].setData(data.roomUserInfo.userId, this.ownerId);\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (count === GLB.MAX_PLAYER_COUNT && GLB.isRoomOwner) {\r\n            var result = mvs.engine.joinOver(\"\");\r\n            console.log(\"发出关闭房间的通知\");\r\n            if (result !== 0) {\r\n                console.log(\"关闭房间失败，错误码：\", result);\r\n            }\r\n        }\r\n\r\n\r\n    },\r\n\r\n    leaveRoomResponse: function (data) {\r\n        if (data.leaveRoomRsp.status === 200) {\r\n            console.log(\"离开房间成功！\");\r\n        } else {\r\n            console.log(\"离开房间失败\");\r\n        }\r\n        GLB.isRoomOwner = false;\r\n        uiFunc.closeUI(this.node.name);\r\n        this.node.destroy();\r\n    },\r\n\r\n    leaveRoomMedNotify: function (data) {\r\n        for (var j = 0; j < this.players.length; j++) {\r\n            if (this.players[j].userId === data.userID) {\r\n                this.players[j].init();\r\n                break;\r\n            }\r\n        }\r\n        this.ownerId = data.owner;\r\n        if (this.ownerId === GLB.userInfo.id) {\r\n            GLB.isRoomOwner = true;\r\n        }\r\n        for (var i = 0; i < this.players.length; i++) {\r\n            if (this.players[i].userId !== 0) {\r\n                this.players[i].setData(this.players[i].userId, this.ownerId);\r\n            }\r\n        }\r\n        this.refreshStartBtn();\r\n    },\r\n\r\n    leaveRoomNotify: function (data) {\r\n        for (var j = 0; j < this.players.length; j++) {\r\n            if (this.players[j].userId === data.leaveRoomInfo.userId) {\r\n                this.players[j].init();\r\n                break;\r\n            }\r\n        }\r\n        this.ownerId = data.leaveRoomInfo.owner;\r\n        if (this.ownerId === GLB.userInfo.id) {\r\n            GLB.isRoomOwner = true;\r\n        }\r\n        for (var i = 0; i < this.players.length; i++) {\r\n            if (this.players[i].userId !== 0) {\r\n                this.players[i].setData(this.players[i].userId, this.ownerId);\r\n            }\r\n        }\r\n        this.refreshStartBtn();\r\n    },\r\n\r\n    refreshStartBtn() {\r\n\r\n    },\r\n\r\n    quit: function () {\r\n        mvs.engine.leaveRoom(\"\");\r\n    },\r\n\r\n\r\n    readyGame() {\r\n\r\n        if (this.isPrepared == false) {//若未准备\r\n            this.nodeDict['prepare'].color = this.prepared;//颜色变暗\r\n            this.isPrepared = true;\r\n            this.nodeDict['blockInput'].active = true;//阻止触摸\r\n\r\n            mvs.engine.sendEvent(JSON.stringify({\r\n                action: GLB.PLAYER_READY,\r\n                playerId: GLB.userInfo.id\r\n            }));\r\n\r\n            GLB.playerReady.push(String(GLB.userInfo.id));\r\n\r\n            this.checkStart();\r\n        } else {//若已准备\r\n            this.nodeDict['prepare'].color = this.noprepared;//颜色变亮\r\n            this.isPrepared = false;\r\n            this.nodeDict['blockInput'].active = false;//允许触摸\r\n\r\n            mvs.engine.sendEvent(JSON.stringify({\r\n                action: GLB.PLAYER_Cancel_READY,\r\n                playerId: GLB.userInfo.id\r\n            }));\r\n\r\n            let index = GLB.playerReady.indexOf(String(GLB.userInfo.id));\r\n            if (index !== -1) {\r\n\r\n                GLB.playerReady.splice(index, 1);\r\n            }\r\n\r\n        }\r\n\r\n\r\n    },\r\n\r\n\r\n\r\n    createRoomInit(rsp) {\r\n        this.roomId = rsp.roomID;\r\n        this.ownerId = rsp.owner;\r\n        this.players[0].setData(this.ownerId, this.ownerId);\r\n        GLB.isRoomOwner = true;\r\n\r\n        this.nodeDict['tip'].active = true;\r\n        this.refreshStartBtn();\r\n        //this.nodeDict[\"prepare\"].active = false;\r\n    },\r\n\r\n    joinRoomInit(roomUserInfoList, roomInfo) {\r\n        roomUserInfoList.sort(function (a, b) {\r\n            if (roomInfo.ownerId === b.userId) {\r\n                return 1;\r\n            }\r\n            return 0;\r\n        });\r\n        this.ownerId = roomInfo.ownerId;\r\n        for (var j = 0; j < roomUserInfoList.length; j++) {\r\n            this.players[j].setData(roomUserInfoList[j].userId, this.ownerId);\r\n        }\r\n        this.refreshStartBtn();\r\n        this.nodeDict['PGbackground'].getComponent(cc.PageView).enabled = false;\r\n        //this.nodeDict[\"startGame\"].active = false;\r\n    },\r\n\r\n    inviteFriend() {\r\n        var url = cc.url.raw('resources/share.png');\r\n        if (window.wx) {\r\n            wx.shareAppMessage({\r\n                title: \"快和我一起加入建筑保卫战\",\r\n                imageUrl: url,\r\n                query: 'id=' + GLB.roomId,\r\n                complete: function () {\r\n                    console.log(arguments);\r\n                },\r\n                success: function (shareTickets, groupMsgInfos) {\r\n                    console.log(shareTickets);\r\n                    console.log(groupMsgInfos);\r\n                }\r\n            })\r\n        }\r\n\r\n    },\r\n\r\n\r\n    levelChangeSync() {\r\n        mvs.engine.sendEvent(JSON.stringify({\r\n            action: GLB.LEVEL_SYNC,\r\n            levelIndex: GLB.levelIndex\r\n        }));\r\n    },\r\n\r\n    levelUpdate() {\r\n\r\n        var tagetPosX;\r\n        switch (GLB.levelIndex) {\r\n            case 1:\r\n                tagetPosX = -375;\r\n                break;\r\n            case 2:\r\n                tagetPosX = -1125;\r\n                break;\r\n            case 3:\r\n                tagetPosX = -1875;\r\n                break;\r\n            default:\r\n                console.log(\"error index\");\r\n\r\n        }\r\n\r\n        var target = this.nodeDict[\"content\"];\r\n        createjs.Tween.get(target).to({ x: tagetPosX }, 1000).call(handleComplete);\r\n        function handleComplete() {\r\n            //渐变完成执行\r\n        }\r\n    },\r\n\r\n\r\n    onDestroy() {\r\n        clientEvent.off(clientEvent.eventType.joinRoomNotify, this.joinRoomNotify, this);\r\n        clientEvent.off(clientEvent.eventType.leaveRoomResponse, this.leaveRoomResponse, this);\r\n        clientEvent.off(clientEvent.eventType.leaveRoomNotify, this.leaveRoomNotify, this);\r\n        clientEvent.off(clientEvent.eventType.levelChangeSync, this.levelChangeSync, this);\r\n        clientEvent.off(clientEvent.eventType.levelUpdate, this.levelUpdate, this);\r\n        clientEvent.off(clientEvent.eventType.checkStart, this.checkStart, this);\r\n    },\r\n\r\n    checkStart() {\r\n\r\n        if (GLB.isRoomOwner && GLB.playerReady.length === GLB.MAX_PLAYER_COUNT) {\r\n\r\n            var userIds = [];\r\n            var tempIds = [];\r\n            var playerCnt = 0;\r\n\r\n            for (var j = 0; j < this.players.length; j++) {\r\n                if (this.players[j].userId !== GLB.userInfo.id) {\r\n                    if (!GLB.playerReady.includes(String(this.players[j].userId))) {\r\n                        break;\r\n                    }\r\n                }\r\n\r\n\r\n                if (this.players[j].userId !== 0) {\r\n                    playerCnt++;\r\n                    userIds.push(this.players[j].userId);\r\n                    tempIds.push(this.players[j].userId);\r\n                }\r\n            }\r\n\r\n\r\n            if (playerCnt === GLB.MAX_PLAYER_COUNT) {\r\n\r\n\r\n                GLB.playerUserIds = userIds;\r\n\r\n\r\n                for (var i = 0, len = tempIds.length; i < len; i++) {\r\n                    var j = Math.floor(Math.random() * (len - i));\r\n                    \r\n                    mvs.engine.sendEventEx(0, JSON.stringify({\r\n                        action: GLB.CAMP,\r\n                        camp: ((i%2 == 0)?0:1),\r\n                    }), 0, [tempIds[j]]);\r\n                    \r\n\r\n                    for (var z = 0; z < GLB.playerUserIds.length; z++) {\r\n                        if(GLB.playerUserIds[z] == tempIds[j]){\r\n                            if(i%2 == 0){\r\n                                GLB.good.push(z);\r\n                            }else{\r\n                                GLB.bad.push(z);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    tempIds.splice(j,1);\r\n\r\n                }\r\n                //开始游戏信号改到接受完阵营分配后进行\r\n                setTimeout(()=>{\r\n                    var msg = {\r\n                        action: GLB.GAME_START_EVENT,\r\n                        userIds: GLB.playerUserIds\r\n                    };\r\n                    Game.GameManager.sendEventEx(msg);\r\n                },500);\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n});\r\n"]}